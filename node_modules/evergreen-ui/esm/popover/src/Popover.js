import _extends from "@babel/runtime/helpers/esm/extends";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import React, { memo, forwardRef, useRef, useState, useEffect, useImperativeHandle, useCallback, useMemo } from 'react';
import cx from 'classnames';
import { css as glamorCss } from 'glamor';
import PropTypes from 'prop-types';
import { Positioner } from '../../positioner';
import { Tooltip } from '../../tooltip';
import { Position } from '../../constants';
import { useMergedRef } from '../../hooks';
import PopoverStateless from './PopoverStateless';

var noop = function noop() {};

var emptyProps = {};
var Popover = memo(forwardRef(function Popover(_ref, forwardedRef) {
  var _ref$animationDuratio = _ref.animationDuration,
      animationDuration = _ref$animationDuratio === void 0 ? 300 : _ref$animationDuratio,
      _ref$bringFocusInside = _ref.bringFocusInside,
      shouldBringFocusInside = _ref$bringFocusInside === void 0 ? false : _ref$bringFocusInside,
      children = _ref.children,
      content = _ref.content,
      display = _ref.display,
      _ref$minHeight = _ref.minHeight,
      minHeight = _ref$minHeight === void 0 ? 40 : _ref$minHeight,
      _ref$minWidth = _ref.minWidth,
      minWidth = _ref$minWidth === void 0 ? 200 : _ref$minWidth,
      _ref$onBodyClick = _ref.onBodyClick,
      onBodyClick = _ref$onBodyClick === void 0 ? noop : _ref$onBodyClick,
      _ref$onClose = _ref.onClose,
      onClose = _ref$onClose === void 0 ? noop : _ref$onClose,
      _ref$onCloseComplete = _ref.onCloseComplete,
      onCloseComplete = _ref$onCloseComplete === void 0 ? noop : _ref$onCloseComplete,
      _ref$onOpen = _ref.onOpen,
      onOpen = _ref$onOpen === void 0 ? noop : _ref$onOpen,
      _ref$onOpenComplete = _ref.onOpenComplete,
      onOpenComplete = _ref$onOpenComplete === void 0 ? noop : _ref$onOpenComplete,
      _ref$position = _ref.position,
      position = _ref$position === void 0 ? Position.BOTTOM : _ref$position,
      _ref$shouldCloseOnExt = _ref.shouldCloseOnExternalClick,
      shouldCloseOnExternalClick = _ref$shouldCloseOnExt === void 0 ? true : _ref$shouldCloseOnExt,
      _ref$statelessProps = _ref.statelessProps,
      statelessProps = _ref$statelessProps === void 0 ? emptyProps : _ref$statelessProps,
      _ref$trigger = _ref.trigger,
      trigger = _ref$trigger === void 0 ? 'click' : _ref$trigger,
      props = _objectWithoutProperties(_ref, ["animationDuration", "bringFocusInside", "children", "content", "display", "minHeight", "minWidth", "onBodyClick", "onClose", "onCloseComplete", "onOpen", "onOpenComplete", "position", "shouldCloseOnExternalClick", "statelessProps", "trigger"]);

  var _useState = useState(props.isShown),
      _useState2 = _slicedToArray(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var popoverNode = useRef();
  var setPopoverNode = useMergedRef(popoverNode);
  var targetRef = useRef();
  var setTargetRef = useMergedRef(targetRef);
  useImperativeHandle(forwardedRef, function () {
    return {
      open: open,
      close: close
    };
  }, [popoverNode.current]);
  /**
   * Methods borrowed from BlueprintJS
   * https://github.com/palantir/blueprint/blob/release/2.0.0/packages/core/src/components/overlay/overlay.tsx
   */

  var bringFocusInside = useCallback(function (e) {
    if (isShown && e) {
      e.preventDefault();
    } // Always delay focus manipulation to just before repaint to prevent scroll jumping


    return requestAnimationFrame(function () {
      // Container ref may be undefined between component mounting and Portal rendering
      // ActiveElement may be undefined in some rare cases in IE
      if (popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null || // eslint-disable-line eqeqeq, no-eq-null
      !isShown) {
        return;
      }

      var isFocusOutsideModal = !popoverNode.current.contains(document.activeElement);

      if (isFocusOutsideModal) {
        // Element marked autofocus has higher priority than the other elements
        var autofocusElement = popoverNode.current.querySelector('[autofocus]:not([disabled])');

        if (autofocusElement) {
          // Return early to avoid unnecessary dom queries
          return autofocusElement.focus();
        }

        var wrapperElement = popoverNode.current.querySelector('[tabindex]:not([disabled])');

        if (wrapperElement) {
          return wrapperElement.focus();
        }

        var buttonElements = popoverNode.current.querySelectorAll('button:not([disabled]), a:not([disabled]), [role="menuitem"]:not([disabled]), [role="menuitemradio"]:not([disabled])');

        if (buttonElements.length > 0) {
          return buttonElements[0].focus();
        }
      }
    });
  }, [isShown, popoverNode.current]);
  var bringFocusBackToTarget = useCallback(function () {
    return requestAnimationFrame(function () {
      if (targetRef.current == null || // eslint-disable-line eqeqeq, no-eq-null
      popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null // eslint-disable-line eqeqeq, no-eq-null
      ) {
          return;
        }

      var isFocusInsideModal = popoverNode.current.contains(document.activeElement); // Bring back focus on the target.

      if (document.activeElement === document.body || isFocusInsideModal) {
        targetRef.current.focus();
      }
    });
  }, [popoverNode.current, targetRef.current]);
  var open = useCallback(function () {
    if (isShown) {
      return;
    }

    setIsShown(true);
    onOpen();
  }, [setIsShown, onOpen, isShown]);
  var close = useCallback(function () {
    if (!isShown) {
      return;
    }

    setIsShown(false);
    bringFocusBackToTarget();
    onClose();
  }, [setIsShown, bringFocusBackToTarget, onClose, isShown]); // If `props.isShown` is a boolean, treat as a controlled component
  // `open` and `close` should be applied when it changes

  useEffect(function () {
    if (typeof props.isShown !== 'boolean' || props.isShown === isShown) {
      return;
    }

    if (props.isShown) {
      open();
    } else {
      close();
    }
  }, [props.isShown, isShown]);
  var toggle = useCallback(function () {
    return isShown ? close() : open();
  }, [isShown, close, open]);
  var handleOpenHover = useMemo(function () {
    return trigger === 'hover' ? open : undefined;
  }, [trigger, open]);
  var handleCloseHover = useMemo(function () {
    return trigger === 'hover' ? close : undefined;
  }, [trigger, close]);
  var handleKeyDown = useCallback(function (event) {
    return event.key === 'ArrowDown' ? bringFocusInside(event) : undefined;
  }, [bringFocusInside]);
  var onEsc = useCallback(function (event) {
    return event.key === 'Escape' ? close() : undefined;
  }, [close]);
  var handleBodyClick = useCallback(function (event) {
    // Ignore clicks on the popover or button
    if (targetRef.current && targetRef.current.contains(event.target)) {
      return;
    }

    if (popoverNode.current && popoverNode.current.contains(event.target)) {
      return;
    } // Notify body click


    onBodyClick(event);

    if (shouldCloseOnExternalClick !== false) {
      close();
    }
  }, [onBodyClick, shouldCloseOnExternalClick, close, targetRef.current, popoverNode.current]);
  var handleOpenComplete = useCallback(function () {
    if (shouldBringFocusInside) bringFocusInside();
    onOpenComplete();
  }, [shouldBringFocusInside, bringFocusInside, onOpenComplete]);
  useEffect(function () {
    if (isShown) {
      document.body.addEventListener('click', handleBodyClick, false);
      document.body.addEventListener('keydown', onEsc, false);
    } else {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    }

    return function () {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    };
  }, [isShown, handleBodyClick, onEsc]);
  var renderTarget = useCallback(function (_ref2) {
    var getRef = _ref2.getRef,
        isShown = _ref2.isShown;
    var isTooltipInside = children && children.type === Tooltip;

    var getTargetRef = function getTargetRef(ref) {
      setTargetRef(ref);
      getRef(ref);
    };
    /**
     * When a function is passed, you can control the Popover manually.
     */


    if (typeof children === 'function') {
      return children({
        getRef: getTargetRef,
        isShown: isShown,
        toggle: toggle
      });
    }

    var popoverTargetProps = {
      onClick: toggle,
      onMouseEnter: handleOpenHover,
      onKeyDown: handleKeyDown,
      role: 'button',
      'aria-expanded': isShown,
      'aria-haspopup': true
    };
    /**
     * Tooltips can be used within a Popover (not the other way around)
     * In this case the children is the Tooltip instead of a button.
     * Pass the properties to the Tooltip and let the Tooltip
     * add the properties to the target.
     */

    if (isTooltipInside) {
      return React.cloneElement(children, {
        popoverProps: _objectSpread({
          getTargetRef: getTargetRef,
          isShown: isShown
        }, popoverTargetProps)
      });
    }
    /**
     * With normal usage only popover props end up on the target.
     */


    return React.cloneElement(children, _objectSpread({
      ref: getTargetRef
    }, popoverTargetProps));
  }, [children, setTargetRef, toggle, handleOpenHover, handleKeyDown]); // If `props.isShown` is a boolean, popover is controlled manually, not via mouse events

  var shown = typeof props.isShown === 'boolean' ? props.isShown : isShown;
  var contentToRender = useMemo(function () {
    return typeof content === 'function' ? content({
      close: close
    }) : content;
  }, [content, close]);
  return React.createElement(Positioner, {
    target: renderTarget,
    isShown: shown,
    position: position,
    animationDuration: animationDuration,
    onOpenComplete: handleOpenComplete,
    onCloseComplete: onCloseComplete
  }, function (_ref3) {
    var css = _ref3.css,
        style = _ref3.style,
        state = _ref3.state,
        getRef = _ref3.getRef;
    return React.createElement(PopoverStateless, _extends({
      ref: function ref(_ref4) {
        setPopoverNode(_ref4);
        getRef(_ref4);
      },
      "data-state": state,
      display: display,
      minWidth: minWidth,
      minHeight: minHeight
    }, statelessProps, {
      className: cx(statelessProps.className, glamorCss(css, style, statelessProps.style).toString()) // Overwrite `statelessProps.style` since we are including it via className
      ,
      style: undefined,
      onMouseLeave: handleCloseHover
    }), contentToRender);
  });
}));
Popover.propTypes = {
  /**
   * The position the Popover is on. Smart positioning might override this.
   */
  position: PropTypes.oneOf([Position.TOP, Position.TOP_LEFT, Position.TOP_RIGHT, Position.BOTTOM, Position.BOTTOM_LEFT, Position.BOTTOM_RIGHT, Position.LEFT, Position.RIGHT]),

  /**
   * When true, the Popover is manually shown.
   */
  isShown: PropTypes.bool,

  /**
   * Open the Popover based on click or hover. Default is click.
   */
  trigger: PropTypes.oneOf(['click', 'hover']),

  /**
   * The content of the Popover.
   */
  content: PropTypes.oneOfType([PropTypes.node, PropTypes.func]).isRequired,

  /**
   * The target button of the Popover.
   * When a function the following arguments are passed:
   * ({ toggle: Function -> Void, getRef: Function -> Ref, isShown: Bool })
   */
  children: PropTypes.oneOfType([PropTypes.element, PropTypes.func]).isRequired,

  /**
   * The display property passed to the Popover card.
   */
  display: PropTypes.string,

  /**
   * The min width of the Popover card.
   */
  minWidth: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),

  /**
   * The min height of the Popover card.
   */
  minHeight: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),

  /**
   * Properties passed through to the Popover card.
   */
  statelessProps: PropTypes.shape(PopoverStateless.propTypes),

  /**
   * Duration of the animation.
   */
  animationDuration: PropTypes.number,

  /**
   * Function called when the Popover opens.
   */
  onOpen: PropTypes.func,

  /**
   * Function fired when Popover closes.
   */
  onClose: PropTypes.func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: PropTypes.func,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: PropTypes.func,

  /**
   * Function that will be called when the body is clicked.
   */
  onBodyClick: PropTypes.func,

  /**
   * When true, bring focus inside of the Popover on open.
   */
  bringFocusInside: PropTypes.bool,

  /**
   * Boolean indicating if clicking outside the dialog should close the dialog.
   */
  shouldCloseOnExternalClick: PropTypes.bool
};
export default Popover;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3BvdmVyL3NyYy9Qb3BvdmVyLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwibWVtbyIsImZvcndhcmRSZWYiLCJ1c2VSZWYiLCJ1c2VTdGF0ZSIsInVzZUVmZmVjdCIsInVzZUltcGVyYXRpdmVIYW5kbGUiLCJ1c2VDYWxsYmFjayIsInVzZU1lbW8iLCJjeCIsImNzcyIsImdsYW1vckNzcyIsIlByb3BUeXBlcyIsIlBvc2l0aW9uZXIiLCJUb29sdGlwIiwiUG9zaXRpb24iLCJ1c2VNZXJnZWRSZWYiLCJQb3BvdmVyU3RhdGVsZXNzIiwibm9vcCIsImVtcHR5UHJvcHMiLCJQb3BvdmVyIiwiZm9yd2FyZGVkUmVmIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJicmluZ0ZvY3VzSW5zaWRlIiwic2hvdWxkQnJpbmdGb2N1c0luc2lkZSIsImNoaWxkcmVuIiwiY29udGVudCIsImRpc3BsYXkiLCJtaW5IZWlnaHQiLCJtaW5XaWR0aCIsIm9uQm9keUNsaWNrIiwib25DbG9zZSIsIm9uQ2xvc2VDb21wbGV0ZSIsIm9uT3BlbiIsIm9uT3BlbkNvbXBsZXRlIiwicG9zaXRpb24iLCJCT1RUT00iLCJzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayIsInN0YXRlbGVzc1Byb3BzIiwidHJpZ2dlciIsInByb3BzIiwiaXNTaG93biIsInNldElzU2hvd24iLCJwb3BvdmVyTm9kZSIsInNldFBvcG92ZXJOb2RlIiwidGFyZ2V0UmVmIiwic2V0VGFyZ2V0UmVmIiwib3BlbiIsImNsb3NlIiwiY3VycmVudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImlzRm9jdXNPdXRzaWRlTW9kYWwiLCJjb250YWlucyIsImF1dG9mb2N1c0VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJ3cmFwcGVyRWxlbWVudCIsImJ1dHRvbkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImJyaW5nRm9jdXNCYWNrVG9UYXJnZXQiLCJpc0ZvY3VzSW5zaWRlTW9kYWwiLCJib2R5IiwidG9nZ2xlIiwiaGFuZGxlT3BlbkhvdmVyIiwidW5kZWZpbmVkIiwiaGFuZGxlQ2xvc2VIb3ZlciIsImhhbmRsZUtleURvd24iLCJldmVudCIsImtleSIsIm9uRXNjIiwiaGFuZGxlQm9keUNsaWNrIiwidGFyZ2V0IiwiaGFuZGxlT3BlbkNvbXBsZXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJUYXJnZXQiLCJnZXRSZWYiLCJpc1Rvb2x0aXBJbnNpZGUiLCJ0eXBlIiwiZ2V0VGFyZ2V0UmVmIiwicmVmIiwicG9wb3ZlclRhcmdldFByb3BzIiwib25DbGljayIsIm9uTW91c2VFbnRlciIsIm9uS2V5RG93biIsInJvbGUiLCJjbG9uZUVsZW1lbnQiLCJwb3BvdmVyUHJvcHMiLCJzaG93biIsImNvbnRlbnRUb1JlbmRlciIsInN0eWxlIiwic3RhdGUiLCJjbGFzc05hbWUiLCJ0b1N0cmluZyIsInByb3BUeXBlcyIsIm9uZU9mIiwiVE9QIiwiVE9QX0xFRlQiLCJUT1BfUklHSFQiLCJCT1RUT01fTEVGVCIsIkJPVFRPTV9SSUdIVCIsIkxFRlQiLCJSSUdIVCIsImJvb2wiLCJvbmVPZlR5cGUiLCJub2RlIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJlbGVtZW50Iiwic3RyaW5nIiwibnVtYmVyIiwic2hhcGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU9BLEtBQVAsSUFDRUMsSUFERixFQUVFQyxVQUZGLEVBR0VDLE1BSEYsRUFJRUMsUUFKRixFQUtFQyxTQUxGLEVBTUVDLG1CQU5GLEVBT0VDLFdBUEYsRUFRRUMsT0FSRixRQVNPLE9BVFA7QUFVQSxPQUFPQyxFQUFQLE1BQWUsWUFBZjtBQUNBLFNBQVNDLEdBQUcsSUFBSUMsU0FBaEIsUUFBaUMsUUFBakM7QUFDQSxPQUFPQyxTQUFQLE1BQXNCLFlBQXRCO0FBQ0EsU0FBU0MsVUFB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aUJBQWlCLEVBQUVWLFNBQVMsQ0FBQ3VHLE1BM0RYOztBQTZEbEI7OztBQUdBbEYsRUFBQUEsTUFBTSxFQUFFckIsU0FBUyxDQUFDbUcsSUFoRUE7O0FBa0VsQjs7O0FBR0FoRixFQUFBQSxPQUFPLEVBQUVuQixTQUFTLENBQUNtRyxJQXJFRDs7QUF1RWxCOzs7QUFHQTdFLEVBQUFBLGNBQWMsRUFBRXRCLFNBQVMsQ0FBQ21HLElBMUVSOztBQTRFbEI7OztBQUdBL0UsRUFBQUEsZUFBZSxFQUFFcEIsU0FBUyxDQUFDbUcsSUEvRVQ7O0FBaUZsQjs7O0FBR0FqRixFQUFBQSxXQUFXLEVBQUVsQixTQUFTLENBQUNtRyxJQXBGTDs7QUFzRmxCOzs7QUFHQXhGLEVBQUFBLGdCQUFnQixFQUFFWCxTQUFTLENBQUNnRyxJQXpGVjs7QUEyRmxCOzs7QUFHQXZFLEVBQUFBLDBCQUEwQixFQUFFekIsU0FBUyxDQUFDZ0c7QUE5RnBCLENBQXBCO0FBaUdBLGVBQWV4RixPQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gIG1lbW8sXG4gIGZvcndhcmRSZWYsXG4gIHVzZVJlZixcbiAgdXNlU3RhdGUsXG4gIHVzZUVmZmVjdCxcbiAgdXNlSW1wZXJhdGl2ZUhhbmRsZSxcbiAgdXNlQ2FsbGJhY2ssXG4gIHVzZU1lbW9cbn0gZnJvbSAncmVhY3QnXG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcydcbmltcG9ydCB7IGNzcyBhcyBnbGFtb3JDc3MgfSBmcm9tICdnbGFtb3InXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgeyBQb3NpdGlvbmVyIH0gZnJvbSAnLi4vLi4vcG9zaXRpb25lcidcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICcuLi8uLi90b29sdGlwJ1xuaW1wb3J0IHsgUG9zaXRpb24gfSBmcm9tICcuLi8uLi9jb25zdGFudHMnXG5pbXBvcnQgeyB1c2VNZXJnZWRSZWYgfSBmcm9tICcuLi8uLi9ob29rcydcbmltcG9ydCBQb3BvdmVyU3RhdGVsZXNzIGZyb20gJy4vUG9wb3ZlclN0YXRlbGVzcydcblxuY29uc3Qgbm9vcCA9ICgpID0+IHt9XG5jb25zdCBlbXB0eVByb3BzID0ge31cblxuY29uc3QgUG9wb3ZlciA9IG1lbW8oXG4gIGZvcndhcmRSZWYoZnVuY3Rpb24gUG9wb3ZlcihcbiAgICB7XG4gICAgICBhbmltYXRpb25EdXJhdGlvbiA9IDMwMCxcbiAgICAgIGJyaW5nRm9jdXNJbnNpZGU6IHNob3VsZEJyaW5nRm9jdXNJbnNpZGUgPSBmYWxzZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgY29udGVudCxcbiAgICAgIGRpc3BsYXksXG4gICAgICBtaW5IZWlnaHQgPSA0MCxcbiAgICAgIG1pbldpZHRoID0gMjAwLFxuICAgICAgb25Cb2R5Q2xpY2sgPSBub29wLFxuICAgICAgb25DbG9zZSA9IG5vb3AsXG4gICAgICBvbkNsb3NlQ29tcGxldGUgPSBub29wLFxuICAgICAgb25PcGVuID0gbm9vcCxcbiAgICAgIG9uT3BlbkNvbXBsZXRlID0gbm9vcCxcbiAgICAgIHBvc2l0aW9uID0gUG9zaXRpb24uQk9UVE9NLFxuICAgICAgc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2sgPSB0cnVlLFxuICAgICAgc3RhdGVsZXNzUHJvcHMgPSBlbXB0eVByb3BzLFxuICAgICAgdHJpZ2dlciA9ICdjbGljaycsXG4gICAgICAuLi5wcm9wc1xuICAgIH0sXG4gICAgZm9yd2FyZGVkUmVmXG4gICkge1xuICAgIGNvbnN0IFtpc1Nob3duLCBzZXRJc1Nob3duXSA9IHVzZVN0YXRlKHByb3BzLmlzU2hvd24pXG4gICAgY29uc3QgcG9wb3Zlck5vZGUgPSB1c2VSZWYoKVxuICAgIGNvbnN0IHNldFBvcG92ZXJOb2RlID0gdXNlTWVyZ2VkUmVmKHBvcG92ZXJOb2RlKVxuICAgIGNvbnN0IHRhcmdldFJlZiA9IHVzZVJlZigpXG4gICAgY29uc3Qgc2V0VGFyZ2V0UmVmID0gdXNlTWVyZ2VkUmVmKHRhcmdldFJlZilcblxuICAgIHVzZUltcGVyYXRpdmVIYW5kbGUoXG4gICAgICBmb3J3YXJkZWRSZWYsXG4gICAgICAoKSA9PiAoe1xuICAgICAgICBvcGVuLFxuICAgICAgICBjbG9zZVxuICAgICAgfSksXG4gICAgICBbcG9wb3Zlck5vZGUuY3VycmVudF1cbiAgICApXG5cbiAgICAvKipcbiAgICAgKiBNZXRob2RzIGJvcnJvd2VkIGZyb20gQmx1ZXByaW50SlNcbiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vcGFsYW50aXIvYmx1ZXByaW50L2Jsb2IvcmVsZWFzZS8yLjAuMC9wYWNrYWdlcy9jb3JlL3NyYy9jb21wb25lbnRzL292ZXJsYXkvb3ZlcmxheS50c3hcbiAgICAgKi9cbiAgICBjb25zdCBicmluZ0ZvY3VzSW5zaWRlID0gdXNlQ2FsbGJhY2soKGUpID0+IHtcbiAgICAgIGlmKGlzU2hvd24gJiYgZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIH1cbiAgICAgIC8vIEFsd2F5cyBkZWxheSBmb2N1cyBtYW5pcHVsYXRpb24gdG8ganVzdCBiZWZvcmUgcmVwYWludCB0byBwcmV2ZW50IHNjcm9sbCBqdW1waW5nXG5cbiAgICAgIHJldHVybiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAvLyBDb250YWluZXIgcmVmIG1heSBiZSB1bmRlZmluZWQgYmV0d2VlbiBjb21wb25lbnQgbW91bnRpbmcgYW5kIFBvcnRhbCByZW5kZXJpbmdcblxuICAgICAgICAvLyBBY3RpdmVFbGVtZW50IG1heSBiZSB1bmRlZmluZWQgaW4gc29tZSByYXJlIGNhc2VzIGluIElFXG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHBvcG92ZXJOb2RlLmN1cnJlbnQgPT0gbnVsbCB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT0gbnVsbCB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICAgICFpc1Nob3duXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNGb2N1c091dHNpZGVNb2RhbCA9ICFwb3BvdmVyTm9kZS5jdXJyZW50LmNvbnRhaW5zKFxuICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRcbiAgICAgICAgKVxuICAgICAgICBpZiAoaXNGb2N1c091dHNpZGVNb2RhbCkge1xuICAgICAgICAgIC8vIEVsZW1lbnQgbWFya2VkIGF1dG9mb2N1cyBoYXMgaGlnaGVyIHByaW9yaXR5IHRoYW4gdGhlIG90aGVyIGVsZW1lbnRzXG4gICAgICAgICAgY29uc3QgYXV0b2ZvY3VzRWxlbWVudCA9IHBvcG92ZXJOb2RlLmN1cnJlbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICdbYXV0b2ZvY3VzXTpub3QoW2Rpc2FibGVkXSknXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChhdXRvZm9jdXNFbGVtZW50KSB7XG4gICAgICAgICAgICAvLyBSZXR1cm4gZWFybHkgdG8gYXZvaWQgdW5uZWNlc3NhcnkgZG9tIHF1ZXJpZXNcbiAgICAgICAgICAgIHJldHVybiBhdXRvZm9jdXNFbGVtZW50LmZvY3VzKClcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB3cmFwcGVyRWxlbWVudCA9IHBvcG92ZXJOb2RlLmN1cnJlbnQucXVlcnlTZWxlY3RvcignW3RhYmluZGV4XTpub3QoW2Rpc2FibGVkXSknKVxuICAgICAgICAgIGlmICh3cmFwcGVyRWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHdyYXBwZXJFbGVtZW50LmZvY3VzKClcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBidXR0b25FbGVtZW50cyA9IHBvcG92ZXJOb2RlLmN1cnJlbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgICdidXR0b246bm90KFtkaXNhYmxlZF0pLCBhOm5vdChbZGlzYWJsZWRdKSwgW3JvbGU9XCJtZW51aXRlbVwiXTpub3QoW2Rpc2FibGVkXSksIFtyb2xlPVwibWVudWl0ZW1yYWRpb1wiXTpub3QoW2Rpc2FibGVkXSknXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChidXR0b25FbGVtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gYnV0dG9uRWxlbWVudHNbMF0uZm9jdXMoKVxuICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sIFtpc1Nob3duLCBwb3BvdmVyTm9kZS5jdXJyZW50XSlcblxuICAgIGNvbnN0IGJyaW5nRm9jdXNCYWNrVG9UYXJnZXQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICByZXR1cm4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRhcmdldFJlZi5jdXJyZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICBwb3BvdmVyTm9kZS5jdXJyZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09IG51bGwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc0ZvY3VzSW5zaWRlTW9kYWwgPSBwb3BvdmVyTm9kZS5jdXJyZW50LmNvbnRhaW5zKFxuICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRcbiAgICAgICAgKVxuXG4gICAgICAgIC8vIEJyaW5nIGJhY2sgZm9jdXMgb24gdGhlIHRhcmdldC5cbiAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGRvY3VtZW50LmJvZHkgfHwgaXNGb2N1c0luc2lkZU1vZGFsKSB7XG4gICAgICAgICAgdGFyZ2V0UmVmLmN1cnJlbnQuZm9jdXMoKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sIFtwb3BvdmVyTm9kZS5jdXJyZW50LCB0YXJnZXRSZWYuY3VycmVudF0pXG5cbiAgICBjb25zdCBvcGVuID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKGlzU2hvd24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHNldElzU2hvd24odHJ1ZSlcbiAgICAgIG9uT3BlbigpXG4gICAgfSwgW3NldElzU2hvd24sIG9uT3BlbiwgaXNTaG93bl0pXG5cbiAgICBjb25zdCBjbG9zZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmICghaXNTaG93bikge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgc2V0SXNTaG93bihmYWxzZSlcbiAgICAgIGJyaW5nRm9jdXNCYWNrVG9UYXJnZXQoKVxuICAgICAgb25DbG9zZSgpXG4gICAgfSwgW3NldElzU2hvd24sIGJyaW5nRm9jdXNCYWNrVG9UYXJnZXQsIG9uQ2xvc2UsIGlzU2hvd25dKVxuXG4gICAgLy8gSWYgYHByb3BzLmlzU2hvd25gIGlzIGEgYm9vbGVhbiwgdHJlYXQgYXMgYSBjb250cm9sbGVkIGNvbXBvbmVudFxuICAgIC8vIGBvcGVuYCBhbmQgYGNsb3NlYCBzaG91bGQgYmUgYXBwbGllZCB3aGVuIGl0IGNoYW5nZXNcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBwcm9wcy5pc1Nob3duICE9PSAnYm9vbGVhbicgfHwgcHJvcHMuaXNTaG93biA9PT0gaXNTaG93bikge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BzLmlzU2hvd24pIHtcbiAgICAgICAgb3BlbigpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjbG9zZSgpXG4gICAgICB9XG4gICAgfSwgW3Byb3BzLmlzU2hvd24sIGlzU2hvd25dKVxuXG4gICAgY29uc3QgdG9nZ2xlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgcmV0dXJuIGlzU2hvd24gPyBjbG9zZSgpIDogb3BlbigpXG4gICAgfSwgW2lzU2hvd24sIGNsb3NlLCBvcGVuXSlcblxuICAgIGNvbnN0IGhhbmRsZU9wZW5Ib3ZlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIHRyaWdnZXIgPT09ICdob3ZlcicgPyBvcGVuIDogdW5kZWZpbmVkXG4gICAgfSwgW3RyaWdnZXIsIG9wZW5dKVxuXG4gICAgY29uc3QgaGFuZGxlQ2xvc2VIb3ZlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIHRyaWdnZXIgPT09ICdob3ZlcicgPyBjbG9zZSA6IHVuZGVmaW5lZFxuICAgIH0sIFt0cmlnZ2VyLCBjbG9zZV0pXG5cbiAgICBjb25zdCBoYW5kbGVLZXlEb3duID0gdXNlQ2FsbGJhY2soKGV2ZW50KSA9PiB7XG4gICAgICByZXR1cm4gZXZlbnQua2V5ID09PSAnQXJyb3dEb3duJyA/IGJyaW5nRm9jdXNJbnNpZGUoZXZlbnQpIDogdW5kZWZpbmVkXG4gICAgfSwgW2JyaW5nRm9jdXNJbnNpZGVdKVxuXG4gICAgY29uc3Qgb25Fc2MgPSB1c2VDYWxsYmFjaygoZXZlbnQpID0+IHtcbiAgICAgIHJldHVybiBldmVudC5rZXkgPT09ICdFc2NhcGUnID8gY2xvc2UoKSA6IHVuZGVmaW5lZFxuICAgIH0sIFtjbG9zZV0pXG5cbiAgICBjb25zdCBoYW5kbGVCb2R5Q2xpY2sgPSB1c2VDYWxsYmFjaygoZXZlbnQpID0+IHtcbiAgICAgIC8vIElnbm9yZSBjbGlja3Mgb24gdGhlIHBvcG92ZXIgb3IgYnV0dG9uXG4gICAgICBpZiAodGFyZ2V0UmVmLmN1cnJlbnQgJiYgdGFyZ2V0UmVmLmN1cnJlbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgaWYgKHBvcG92ZXJOb2RlLmN1cnJlbnQgJiYgcG9wb3Zlck5vZGUuY3VycmVudC5jb250YWlucyhldmVudC50YXJnZXQpKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICAvLyBOb3RpZnkgYm9keSBjbGlja1xuICAgICAgb25Cb2R5Q2xpY2soZXZlbnQpXG5cbiAgICAgIGlmIChzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayAhPT0gZmFsc2UpIHtcbiAgICAgICAgY2xvc2UoKVxuICAgICAgfVxuICAgIH0sIFtvbkJvZHlDbGljaywgc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2ssIGNsb3NlLCB0YXJnZXRSZWYuY3VycmVudCwgcG9wb3Zlck5vZGUuY3VycmVudF0pXG5cbiAgICBjb25zdCBoYW5kbGVPcGVuQ29tcGxldGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAoc2hvdWxkQnJpbmdGb2N1c0luc2lkZSkgYnJpbmdGb2N1c0luc2lkZSgpXG4gICAgICBvbk9wZW5Db21wbGV0ZSgpXG4gICAgfSwgW3Nob3VsZEJyaW5nRm9jdXNJbnNpZGUsIGJyaW5nRm9jdXNJbnNpZGUsIG9uT3BlbkNvbXBsZXRlXSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoaXNTaG93bikge1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQm9keUNsaWNrLCBmYWxzZSlcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25Fc2MsIGZhbHNlKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJvZHlDbGljaywgZmFsc2UpXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uRXNjLCBmYWxzZSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJvZHlDbGljaywgZmFsc2UpXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uRXNjLCBmYWxzZSlcbiAgICAgIH1cbiAgICB9LCBbaXNTaG93biwgaGFuZGxlQm9keUNsaWNrLCBvbkVzY10pXG5cbiAgICBjb25zdCByZW5kZXJUYXJnZXQgPSB1c2VDYWxsYmFjaygoeyBnZXRSZWYsIGlzU2hvd24gfSkgPT4ge1xuICAgICAgY29uc3QgaXNUb29sdGlwSW5zaWRlID0gY2hpbGRyZW4gJiYgY2hpbGRyZW4udHlwZSA9PT0gVG9vbHRpcFxuXG4gICAgICBjb25zdCBnZXRUYXJnZXRSZWYgPSByZWYgPT4ge1xuICAgICAgICBzZXRUYXJnZXRSZWYocmVmKVxuICAgICAgICBnZXRSZWYocmVmKVxuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIFdoZW4gYSBmdW5jdGlvbiBpcyBwYXNzZWQsIHlvdSBjYW4gY29udHJvbCB0aGUgUG9wb3ZlciBtYW51YWxseS5cbiAgICAgICAqL1xuICAgICAgaWYgKHR5cGVvZiBjaGlsZHJlbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gY2hpbGRyZW4oe1xuICAgICAgICAgIGdldFJlZjogZ2V0VGFyZ2V0UmVmLFxuICAgICAgICAgIGlzU2hvd24sXG4gICAgICAgICAgdG9nZ2xlXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBvcG92ZXJUYXJnZXRQcm9wcyA9IHtcbiAgICAgICAgb25DbGljazogdG9nZ2xlLFxuICAgICAgICBvbk1vdXNlRW50ZXI6IGhhbmRsZU9wZW5Ib3ZlcixcbiAgICAgICAgb25LZXlEb3duOiBoYW5kbGVLZXlEb3duLFxuICAgICAgICByb2xlOiAnYnV0dG9uJyxcbiAgICAgICAgJ2FyaWEtZXhwYW5kZWQnOiBpc1Nob3duLFxuICAgICAgICAnYXJpYS1oYXNwb3B1cCc6IHRydWVcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBUb29sdGlwcyBjYW4gYmUgdXNlZCB3aXRoaW4gYSBQb3BvdmVyIChub3QgdGhlIG90aGVyIHdheSBhcm91bmQpXG4gICAgICAgKiBJbiB0aGlzIGNhc2UgdGhlIGNoaWxkcmVuIGlzIHRoZSBUb29sdGlwIGluc3RlYWQgb2YgYSBidXR0b24uXG4gICAgICAgKiBQYXNzIHRoZSBwcm9wZXJ0aWVzIHRvIHRoZSBUb29sdGlwIGFuZCBsZXQgdGhlIFRvb2x0aXBcbiAgICAgICAqIGFkZCB0aGUgcHJvcGVydGllcyB0byB0aGUgdGFyZ2V0LlxuICAgICAgICovXG4gICAgICBpZiAoaXNUb29sdGlwSW5zaWRlKSB7XG4gICAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgICAgICBwb3BvdmVyUHJvcHM6IHtcbiAgICAgICAgICAgIGdldFRhcmdldFJlZixcbiAgICAgICAgICAgIGlzU2hvd24sXG5cbiAgICAgICAgICAgIC8vIFRoZXNlIHByb3BldGllcyB3aWxsIGJlIHNwcmVhZCBhcyBgcG9wb3ZlclRhcmdldFByb3BzYFxuICAgICAgICAgICAgLy8gaW4gdGhlIFRvb2x0aXAgY29tcG9uZW50LlxuICAgICAgICAgICAgLi4ucG9wb3ZlclRhcmdldFByb3BzXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIFdpdGggbm9ybWFsIHVzYWdlIG9ubHkgcG9wb3ZlciBwcm9wcyBlbmQgdXAgb24gdGhlIHRhcmdldC5cbiAgICAgICAqL1xuICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZHJlbiwge1xuICAgICAgICByZWY6IGdldFRhcmdldFJlZixcbiAgICAgICAgLi4ucG9wb3ZlclRhcmdldFByb3BzXG4gICAgICB9KVxuICAgIH0sIFtjaGlsZHJlbiwgc2V0VGFyZ2V0UmVmLCB0b2dnbGUsIGhhbmRsZU9wZW5Ib3ZlciwgaGFuZGxlS2V5RG93bl0pXG5cbiAgICAvLyBJZiBgcHJvcHMuaXNTaG93bmAgaXMgYSBib29sZWFuLCBwb3BvdmVyIGlzIGNvbnRyb2xsZWQgbWFudWFsbHksIG5vdCB2aWEgbW91c2UgZXZlbnRzXG4gICAgY29uc3Qgc2hvd24gPSB0eXBlb2YgcHJvcHMuaXNTaG93biA9PT0gJ2Jvb2xlYW4nID8gcHJvcHMuaXNTaG93biA6IGlzU2hvd25cblxuICAgIGNvbnN0IGNvbnRlbnRUb1JlbmRlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIHR5cGVvZiBjb250ZW50ID09PSAnZnVuY3Rpb24nID8gY29udGVudCh7IGNsb3NlIH0pIDogY29udGVudFxuICAgIH0sIFtjb250ZW50LCBjbG9zZV0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFBvc2l0aW9uZXJcbiAgICAgICAgdGFyZ2V0PXtyZW5kZXJUYXJnZXR9XG4gICAgICAgIGlzU2hvd249e3Nob3dufVxuICAgICAgICBwb3NpdGlvbj17cG9zaXRpb259XG4gICAgICAgIGFuaW1hdGlvbkR1cmF0aW9uPXthbmltYXRpb25EdXJhdGlvbn1cbiAgICAgICAgb25PcGVuQ29tcGxldGU9e2hhbmRsZU9wZW5Db21wbGV0ZX1cbiAgICAgICAgb25DbG9zZUNvbXBsZXRlPXtvbkNsb3NlQ29tcGxldGV9XG4gICAgICA+XG4gICAgICAgIHsoeyBjc3MsIHN0eWxlLCBzdGF0ZSwgZ2V0UmVmIH0pID0+IChcbiAgICAgICAgICA8UG9wb3ZlclN0YXRlbGVzc1xuICAgICAgICAgICAgcmVmPXtyZWYgPT4ge1xuICAgICAgICAgICAgICBzZXRQb3BvdmVyTm9kZShyZWYpXG4gICAgICAgICAgICAgIGdldFJlZihyZWYpXG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgZGF0YS1zdGF0ZT17c3RhdGV9XG4gICAgICAgICAgICBkaXNwbGF5PXtkaXNwbGF5fVxuICAgICAgICAgICAgbWluV2lkdGg9e21pbldpZHRofVxuICAgICAgICAgICAgbWluSGVpZ2h0PXttaW5IZWlnaHR9XG4gICAgICAgICAgICB7Li4uc3RhdGVsZXNzUHJvcHN9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBzdGF0ZWxlc3NQcm9wcy5jbGFzc05hbWUsXG4gICAgICAgICAgICAgIGdsYW1vckNzcyhjc3MsIHN0eWxlLCBzdGF0ZWxlc3NQcm9wcy5zdHlsZSkudG9TdHJpbmcoKVxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBgc3RhdGVsZXNzUHJvcHMuc3R5bGVgIHNpbmNlIHdlIGFyZSBpbmNsdWRpbmcgaXQgdmlhIGNsYXNzTmFtZVxuICAgICAgICAgICAgc3R5bGU9e3VuZGVmaW5lZH1cbiAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17aGFuZGxlQ2xvc2VIb3Zlcn1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y29udGVudFRvUmVuZGVyfVxuICAgICAgICAgIDwvUG9wb3ZlclN0YXRlbGVzcz5cbiAgICAgICAgKX1cbiAgICAgIDwvUG9zaXRpb25lcj5cbiAgICApXG4gIH0pXG4pXG5cblBvcG92ZXIucHJvcFR5cGVzID0ge1xuICAvKipcbiAgICogVGhlIHBvc2l0aW9uIHRoZSBQb3BvdmVyIGlzIG9uLiBTbWFydCBwb3NpdGlvbmluZyBtaWdodCBvdmVycmlkZSB0aGlzLlxuICAgKi9cbiAgcG9zaXRpb246IFByb3BUeXBlcy5vbmVPZihbXG4gICAgUG9zaXRpb24uVE9QLFxuICAgIFBvc2l0aW9uLlRPUF9MRUZULFxuICAgIFBvc2l0aW9uLlRPUF9SSUdIVCxcbiAgICBQb3NpdGlvbi5CT1RUT00sXG4gICAgUG9zaXRpb24uQk9UVE9NX0xFRlQsXG4gICAgUG9zaXRpb24uQk9UVE9NX1JJR0hULFxuICAgIFBvc2l0aW9uLkxFRlQsXG4gICAgUG9zaXRpb24uUklHSFRcbiAgXSksXG5cbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSwgdGhlIFBvcG92ZXIgaXMgbWFudWFsbHkgc2hvd24uXG4gICAqL1xuICBpc1Nob3duOiBQcm9wVHlwZXMuYm9vbCxcbiAgLyoqXG4gICAqIE9wZW4gdGhlIFBvcG92ZXIgYmFzZWQgb24gY2xpY2sgb3IgaG92ZXIuIERlZmF1bHQgaXMgY2xpY2suXG4gICAqL1xuICB0cmlnZ2VyOiBQcm9wVHlwZXMub25lT2YoWydjbGljaycsICdob3ZlciddKSxcblxuICAvKipcbiAgICogVGhlIGNvbnRlbnQgb2YgdGhlIFBvcG92ZXIuXG4gICAqL1xuICBjb250ZW50OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubm9kZSwgUHJvcFR5cGVzLmZ1bmNdKS5pc1JlcXVpcmVkLFxuXG4gIC8qKlxuICAgKiBUaGUgdGFyZ2V0IGJ1dHRvbiBvZiB0aGUgUG9wb3Zlci5cbiAgICogV2hlbiBhIGZ1bmN0aW9uIHRoZSBmb2xsb3dpbmcgYXJndW1lbnRzIGFyZSBwYXNzZWQ6XG4gICAqICh7IHRvZ2dsZTogRnVuY3Rpb24gLT4gVm9pZCwgZ2V0UmVmOiBGdW5jdGlvbiAtPiBSZWYsIGlzU2hvd246IEJvb2wgfSlcbiAgICovXG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuZWxlbWVudCwgUHJvcFR5cGVzLmZ1bmNdKS5pc1JlcXVpcmVkLFxuXG4gIC8qKlxuICAgKiBUaGUgZGlzcGxheSBwcm9wZXJ0eSBwYXNzZWQgdG8gdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIGRpc3BsYXk6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgLyoqXG4gICAqIFRoZSBtaW4gd2lkdGggb2YgdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIG1pbldpZHRoOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubnVtYmVyLCBQcm9wVHlwZXMuc3RyaW5nXSksXG5cbiAgLyoqXG4gICAqIFRoZSBtaW4gaGVpZ2h0IG9mIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBtaW5IZWlnaHQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5udW1iZXIsIFByb3BUeXBlcy5zdHJpbmddKSxcblxuICAvKipcbiAgICogUHJvcGVydGllcyBwYXNzZWQgdGhyb3VnaCB0byB0aGUgUG9wb3ZlciBjYXJkLlxuICAgKi9cbiAgc3RhdGVsZXNzUHJvcHM6IFByb3BUeXBlcy5zaGFwZShQb3BvdmVyU3RhdGVsZXNzLnByb3BUeXBlcyksXG5cbiAgLyoqXG4gICAqIER1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24uXG4gICAqL1xuICBhbmltYXRpb25EdXJhdGlvbjogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIFBvcG92ZXIgb3BlbnMuXG4gICAqL1xuICBvbk9wZW46IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBmaXJlZCB3aGVuIFBvcG92ZXIgY2xvc2VzLlxuICAgKi9cbiAgb25DbG9zZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgZW50ZXIgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZS5cbiAgICovXG4gIG9uT3BlbkNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBleGl0IHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAqL1xuICBvbkNsb3NlQ29tcGxldGU6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGJvZHkgaXMgY2xpY2tlZC5cbiAgICovXG4gIG9uQm9keUNsaWNrOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogV2hlbiB0cnVlLCBicmluZyBmb2N1cyBpbnNpZGUgb2YgdGhlIFBvcG92ZXIgb24gb3Blbi5cbiAgICovXG4gIGJyaW5nRm9jdXNJbnNpZGU6IFByb3BUeXBlcy5ib29sLFxuXG4gIC8qKlxuICAgKiBCb29sZWFuIGluZGljYXRpbmcgaWYgY2xpY2tpbmcgb3V0c2lkZSB0aGUgZGlhbG9nIHNob3VsZCBjbG9zZSB0aGUgZGlhbG9nLlxuICAgKi9cbiAgc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2s6IFByb3BUeXBlcy5ib29sXG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcG92ZXJcbiJdfQ==