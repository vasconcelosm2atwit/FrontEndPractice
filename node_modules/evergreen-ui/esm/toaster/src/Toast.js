import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import React, { memo, useMemo, useRef, useState, useEffect, useCallback } from 'react';
import { css } from 'glamor';
import PropTypes from 'prop-types';
import { Transition } from 'react-transition-group';
import Box from 'ui-box';
import Alert from '../../alert/src/Alert';
var animationEasing = {
  deceleration: "cubic-bezier(0.0, 0.0, 0.2, 1)",
  acceleration: "cubic-bezier(0.4, 0.0, 1, 1)",
  spring: "cubic-bezier(0.175, 0.885, 0.320, 1.175)"
};
var ANIMATION_DURATION = 240;
var openAnimation = css.keyframes('openAnimation', {
  from: {
    opacity: 0,
    transform: 'translateY(-120%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});
var closeAnimation = css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});
var animationStyles = css({
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  height: 0,
  transition: "all ".concat(ANIMATION_DURATION, "ms ").concat(animationEasing.deceleration),
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: "".concat(openAnimation, " ").concat(ANIMATION_DURATION, "ms ").concat(animationEasing.spring, " both")
  },
  '&[data-state="exiting"]': {
    animation: "".concat(closeAnimation, " 120ms ").concat(animationEasing.acceleration, " both")
  }
});
var Toast = memo(function Toast(props) {
  var duration = props.duration,
      onRemove = props.onRemove,
      isShownProp = props.isShown,
      _props$intent = props.intent,
      intent = _props$intent === void 0 ? 'none' : _props$intent,
      zIndex = props.zIndex,
      title = props.title,
      children = props.children,
      hasCloseButton = props.hasCloseButton;

  var _useState = useState(true),
      _useState2 = _slicedToArray(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var _useState3 = useState(0),
      _useState4 = _slicedToArray(_useState3, 2),
      height = _useState4[0],
      setHeight = _useState4[1];

  var closeTimer = useRef(null);
  var clearCloseTimer = useCallback(function () {
    if (closeTimer.current) {
      clearTimeout(closeTimer.current);
      closeTimer.current = null;
    }
  });
  var close = useCallback(function () {
    clearCloseTimer();
    setIsShown(false);
  });
  var startCloseTimer = useCallback(function () {
    if (duration) {
      clearCloseTimer();
      closeTimer.current = setTimeout(function () {
        close();
      }, duration * 1000);
    }
  });
  useEffect(function () {
    startCloseTimer();
    return function () {
      clearCloseTimer();
    };
  }, []);
  useEffect(function () {
    if (isShownProp !== isShown && typeof isShownProp === 'boolean') {
      setIsShown(isShownProp);
    }
  }, [isShownProp]);
  var handleMouseEnter = useCallback(function () {
    return clearCloseTimer();
  });
  var handleMouseLeave = useCallback(function () {
    return startCloseTimer();
  });
  var onRef = useCallback(function (ref) {
    if (ref === null) return;

    var _ref$getBoundingClien = ref.getBoundingClientRect(),
        rectHeight = _ref$getBoundingClien.height;

    setHeight(rectHeight);
  });
  var styles = useMemo(function () {
    return {
      height: height,
      zIndex: zIndex,
      marginBottom: isShown ? 0 : -height
    };
  }, [isShown, height, zIndex]);
  return React.createElement(Transition, {
    appear: true,
    unmountOnExit: true,
    timeout: ANIMATION_DURATION,
    "in": isShown,
    onExited: onRemove
  }, function (state) {
    return React.createElement("div", {
      "data-state": state,
      className: animationStyles,
      onMouseEnter: handleMouseEnter,
      onMouseLeave: handleMouseLeave,
      style: styles
    }, React.createElement(Box, {
      ref: onRef,
      padding: 8
    }, React.createElement(Alert, {
      flexShrink: 0,
      appearance: "card",
      elevation: 3,
      intent: intent,
      title: title,
      isRemoveable: hasCloseButton,
      onRemove: close,
      pointerEvents: "all"
    }, children)));
  });
});
Toast.propTypes = {
  /**
   * The z-index of the toast.
   */
  zIndex: PropTypes.number,

  /**
   * Duration of the toast.
   */
  duration: PropTypes.number,

  /**
   * Function called when the toast is all the way closed.
   */
  onRemove: PropTypes.func,

  /**
   * The type of the alert.
   */
  intent: PropTypes.oneOf(['none', 'success', 'warning', 'danger']),

  /**
   * The title of the alert.
   */
  title: PropTypes.node,

  /**
   * Description of the alert.
   */
  children: PropTypes.node,

  /**
   * When true, show a close icon button inside of the toast.
   */
  hasCloseButton: PropTypes.bool,

  /**
   * When false, will close the Toast and call onRemove when finished.
   */
  isShown: PropTypes.bool
};
export default Toast;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdC5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsIm1lbW8iLCJ1c2VNZW1vIiwidXNlUmVmIiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJ1c2VDYWxsYmFjayIsImNzcyIsIlByb3BUeXBlcyIsIlRyYW5zaXRpb24iLCJCb3giLCJBbGVydCIsImFuaW1hdGlvbkVhc2luZyIsImRlY2VsZXJhdGlvbiIsImFjY2VsZXJhdGlvbiIsInNwcmluZyIsIkFOSU1BVElPTl9EVVJBVElPTiIsIm9wZW5BbmltYXRpb24iLCJrZXlmcmFtZXMiLCJmcm9tIiwib3BhY2l0eSIsInRyYW5zZm9ybSIsInRvIiwiY2xvc2VBbmltYXRpb24iLCJhbmltYXRpb25TdHlsZXMiLCJkaXNwbGF5IiwiZmxleERpcmVjdGlvbiIsImFsaWduSXRlbXMiLCJoZWlnaHQiLCJ0cmFuc2l0aW9uIiwiYW5pbWF0aW9uIiwiVG9hc3QiLCJwcm9wcyIsImR1cmF0aW9uIiwib25SZW1vdmUiLCJpc1Nob3duUHJvcCIsImlzU2hvd24iLCJpbnRlbnQiLCJ6SW5kZXgiLCJ0aXRsZSIsImNoaWxkcmVuIiwiaGFzQ2xvc2VCdXR0b24iLCJzZXRJc1Nob3duIiwic2V0SGVpZ2h0IiwiY2xvc2VUaW1lciIsImNsZWFyQ2xvc2VUaW1lciIsImN1cnJlbnQiLCJjbGVhclRpbWVvdXQiLCJjbG9zZSIsInN0YXJ0Q2xvc2VUaW1lciIsInNldFRpbWVvdXQiLCJoYW5kbGVNb3VzZUVudGVyIiwiaGFuZGxlTW91c2VMZWF2ZSIsIm9uUmVmIiwicmVmIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwicmVjdEhlaWdodCIsInN0eWxlcyIsIm1hcmdpbkJvdHRvbSIsInN0YXRlIiwicHJvcFR5cGVzIiwibnVtYmVyIiwiZnVuYyIsIm9uZU9mIiwibm9kZSIsImJvb2wiXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPQSxLQUFQLElBQ0VDLElBREYsRUFFRUMsT0FGRixFQUdFQyxN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QixNQUpWO0FBS0UsTUFBQSxLQUFLLEVBQUVFLEtBTFQ7QUFNRSxNQUFBLFlBQVksRUFBRUUsY0FOaEI7QUFPRSxNQUFBLFFBQVEsRUFBRU8sS0FQWjtBQVFFLE1BQUEsYUFBYSxFQUFDO0FBUmhCLE9BVUdSLFFBVkgsQ0FERixDQVBGLENBREk7QUFBQSxHQVBSLENBREY7QUFrQ0QsQ0F6R2lCLENBQWxCO0FBMkdBVCxLQUFLLENBQUM2QixTQUFOLEdBQWtCO0FBQ2hCOzs7QUFHQXRCLEVBQUFBLE1BQU0sRUFBRTlCLFNBQVMsQ0FBQ3FELE1BSkY7O0FBTWhCOzs7QUFHQTVCLEVBQUFBLFFBQVEsRUFBRXpCLFNBQVMsQ0FBQ3FELE1BVEo7O0FBV2hCOzs7QUFHQTNCLEVBQUFBLFFBQVEsRUFBRTFCLFNBQVMsQ0FBQ3NELElBZEo7O0FBZ0JoQjs7O0FBR0F6QixFQUFBQSxNQUFNLEVBQUU3QixTQUFTLENBQUN1RCxLQUFWLENBQWdCLENBQUMsTUFBRCxFQUFTLFNBQVQsRUFBb0IsU0FBcEIsRUFBK0IsUUFBL0IsQ0FBaEIsQ0FuQlE7O0FBcUJoQjs7O0FBR0F4QixFQUFBQSxLQUFLLEVBQUUvQixTQUFTLENBQUN3RCxJQXhCRDs7QUEwQmhCOzs7QUFHQXhCLEVBQUFBLFFBQVEsRUFBRWhDLFNBQVMsQ0FBQ3dELElBN0JKOztBQStCaEI7OztBQUdBdkIsRUFBQUEsY0FBYyxFQUFFakMsU0FBUyxDQUFDeUQsSUFsQ1Y7O0FBb0NoQjs7O0FBR0E3QixFQUFBQSxPQUFPLEVBQUU1QixTQUFTLENBQUN5RDtBQXZDSCxDQUFsQjtBQTBDQSxlQUFlbEMsS0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xuICBtZW1vLFxuICB1c2VNZW1vLFxuICB1c2VSZWYsXG4gIHVzZVN0YXRlLFxuICB1c2VFZmZlY3QsXG4gIHVzZUNhbGxiYWNrXG59IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJ1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgVHJhbnNpdGlvbiB9IGZyb20gJ3JlYWN0LXRyYW5zaXRpb24tZ3JvdXAnXG5pbXBvcnQgQm94IGZyb20gJ3VpLWJveCdcbmltcG9ydCBBbGVydCBmcm9tICcuLi8uLi9hbGVydC9zcmMvQWxlcnQnXG5cbmNvbnN0IGFuaW1hdGlvbkVhc2luZyA9IHtcbiAgZGVjZWxlcmF0aW9uOiBgY3ViaWMtYmV6aWVyKDAuMCwgMC4wLCAwLjIsIDEpYCxcbiAgYWNjZWxlcmF0aW9uOiBgY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAxLCAxKWAsXG4gIHNwcmluZzogYGN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIwLCAxLjE3NSlgXG59XG5cbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDI0MFxuXG5jb25zdCBvcGVuQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnb3BlbkFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIG9wYWNpdHk6IDAsXG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMTIwJSknXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKSdcbiAgfVxufSlcblxuY29uc3QgY2xvc2VBbmltYXRpb24gPSBjc3Mua2V5ZnJhbWVzKCdjbG9zZUFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDEpJyxcbiAgICBvcGFjaXR5OiAxXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAnc2NhbGUoMC45KScsXG4gICAgb3BhY2l0eTogMFxuICB9XG59KVxuXG5jb25zdCBhbmltYXRpb25TdHlsZXMgPSBjc3Moe1xuICBkaXNwbGF5OiAnZmxleCcsXG4gIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgaGVpZ2h0OiAwLFxuICB0cmFuc2l0aW9uOiBgYWxsICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7YW5pbWF0aW9uRWFzaW5nLmRlY2VsZXJhdGlvbn1gLFxuICAnJltkYXRhLXN0YXRlPVwiZW50ZXJpbmdcIl0sICZbZGF0YS1zdGF0ZT1cImVudGVyZWRcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtvcGVuQW5pbWF0aW9ufSAke0FOSU1BVElPTl9EVVJBVElPTn1tcyAke2FuaW1hdGlvbkVhc2luZy5zcHJpbmd9IGJvdGhgXG4gIH0sXG4gICcmW2RhdGEtc3RhdGU9XCJleGl0aW5nXCJdJzoge1xuICAgIGFuaW1hdGlvbjogYCR7Y2xvc2VBbmltYXRpb259IDEyMG1zICR7YW5pbWF0aW9uRWFzaW5nLmFjY2VsZXJhdGlvbn0gYm90aGBcbiAgfVxufSlcblxuY29uc3QgVG9hc3QgPSBtZW1vKGZ1bmN0aW9uIFRvYXN0KHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBkdXJhdGlvbixcbiAgICBvblJlbW92ZSxcbiAgICBpc1Nob3duOiBpc1Nob3duUHJvcCxcbiAgICAvLyBUZW1wbGF0ZSBwcm9wc1xuICAgIGludGVudCA9ICdub25lJyxcbiAgICB6SW5kZXgsXG4gICAgdGl0bGUsXG4gICAgY2hpbGRyZW4sXG4gICAgaGFzQ2xvc2VCdXR0b25cbiAgfSA9IHByb3BzXG5cbiAgY29uc3QgW2lzU2hvd24sIHNldElzU2hvd25dID0gdXNlU3RhdGUodHJ1ZSlcbiAgY29uc3QgW2hlaWdodCwgc2V0SGVpZ2h0XSA9IHVzZVN0YXRlKDApXG4gIGNvbnN0IGNsb3NlVGltZXIgPSB1c2VSZWYobnVsbClcblxuICBjb25zdCBjbGVhckNsb3NlVGltZXIgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKGNsb3NlVGltZXIuY3VycmVudCkge1xuICAgICAgY2xlYXJUaW1lb3V0KGNsb3NlVGltZXIuY3VycmVudClcbiAgICAgIGNsb3NlVGltZXIuY3VycmVudCA9IG51bGxcbiAgICB9XG4gIH0pXG5cbiAgY29uc3QgY2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgY2xlYXJDbG9zZVRpbWVyKClcbiAgICBzZXRJc1Nob3duKGZhbHNlKVxuICB9KVxuXG4gIGNvbnN0IHN0YXJ0Q2xvc2VUaW1lciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoZHVyYXRpb24pIHtcbiAgICAgIGNsZWFyQ2xvc2VUaW1lcigpXG4gICAgICBjbG9zZVRpbWVyLmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY2xvc2UoKVxuICAgICAgfSwgZHVyYXRpb24gKiAxMDAwKVxuICAgIH1cbiAgfSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHN0YXJ0Q2xvc2VUaW1lcigpXG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY2xlYXJDbG9zZVRpbWVyKClcbiAgICB9XG4gIH0sIFtdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzU2hvd25Qcm9wICE9PSBpc1Nob3duICYmIHR5cGVvZiBpc1Nob3duUHJvcCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBzZXRJc1Nob3duKGlzU2hvd25Qcm9wKVxuICAgIH1cbiAgfSwgW2lzU2hvd25Qcm9wXSlcblxuICBjb25zdCBoYW5kbGVNb3VzZUVudGVyID0gdXNlQ2FsbGJhY2soKCkgPT4gY2xlYXJDbG9zZVRpbWVyKCkpXG4gIGNvbnN0IGhhbmRsZU1vdXNlTGVhdmUgPSB1c2VDYWxsYmFjaygoKSA9PiBzdGFydENsb3NlVGltZXIoKSlcblxuICBjb25zdCBvblJlZiA9IHVzZUNhbGxiYWNrKHJlZiA9PiB7XG4gICAgaWYgKHJlZiA9PT0gbnVsbCkgcmV0dXJuXG5cbiAgICBjb25zdCB7IGhlaWdodDogcmVjdEhlaWdodCB9ID0gcmVmLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgc2V0SGVpZ2h0KHJlY3RIZWlnaHQpXG4gIH0pXG5cbiAgY29uc3Qgc3R5bGVzID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgaGVpZ2h0LFxuICAgICAgekluZGV4LFxuICAgICAgbWFyZ2luQm90dG9tOiBpc1Nob3duID8gMCA6IC1oZWlnaHRcbiAgICB9KSxcbiAgICBbaXNTaG93biwgaGVpZ2h0LCB6SW5kZXhdXG4gIClcblxuICByZXR1cm4gKFxuICAgIDxUcmFuc2l0aW9uXG4gICAgICBhcHBlYXJcbiAgICAgIHVubW91bnRPbkV4aXRcbiAgICAgIHRpbWVvdXQ9e0FOSU1BVElPTl9EVVJBVElPTn1cbiAgICAgIGluPXtpc1Nob3dufVxuICAgICAgb25FeGl0ZWQ9e29uUmVtb3ZlfVxuICAgID5cbiAgICAgIHtzdGF0ZSA9PiAoXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBkYXRhLXN0YXRlPXtzdGF0ZX1cbiAgICAgICAgICBjbGFzc05hbWU9e2FuaW1hdGlvblN0eWxlc31cbiAgICAgICAgICBvbk1vdXNlRW50ZXI9e2hhbmRsZU1vdXNlRW50ZXJ9XG4gICAgICAgICAgb25Nb3VzZUxlYXZlPXtoYW5kbGVNb3VzZUxlYXZlfVxuICAgICAgICAgIHN0eWxlPXtzdHlsZXN9XG4gICAgICAgID5cbiAgICAgICAgICA8Qm94IHJlZj17b25SZWZ9IHBhZGRpbmc9ezh9PlxuICAgICAgICAgICAgPEFsZXJ0XG4gICAgICAgICAgICAgIGZsZXhTaHJpbms9ezB9XG4gICAgICAgICAgICAgIGFwcGVhcmFuY2U9XCJjYXJkXCJcbiAgICAgICAgICAgICAgZWxldmF0aW9uPXszfVxuICAgICAgICAgICAgICBpbnRlbnQ9e2ludGVudH1cbiAgICAgICAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICAgICAgICBpc1JlbW92ZWFibGU9e2hhc0Nsb3NlQnV0dG9ufVxuICAgICAgICAgICAgICBvblJlbW92ZT17Y2xvc2V9XG4gICAgICAgICAgICAgIHBvaW50ZXJFdmVudHM9XCJhbGxcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgICA8L0FsZXJ0PlxuICAgICAgICAgIDwvQm94PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICl9XG4gICAgPC9UcmFuc2l0aW9uPlxuICApXG59KVxuXG5Ub2FzdC5wcm9wVHlwZXMgPSB7XG4gIC8qKlxuICAgKiBUaGUgei1pbmRleCBvZiB0aGUgdG9hc3QuXG4gICAqL1xuICB6SW5kZXg6IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgLyoqXG4gICAqIER1cmF0aW9uIG9mIHRoZSB0b2FzdC5cbiAgICovXG4gIGR1cmF0aW9uOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgdG9hc3QgaXMgYWxsIHRoZSB3YXkgY2xvc2VkLlxuICAgKi9cbiAgb25SZW1vdmU6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUgYWxlcnQuXG4gICAqL1xuICBpbnRlbnQ6IFByb3BUeXBlcy5vbmVPZihbJ25vbmUnLCAnc3VjY2VzcycsICd3YXJuaW5nJywgJ2RhbmdlciddKSxcblxuICAvKipcbiAgICogVGhlIHRpdGxlIG9mIHRoZSBhbGVydC5cbiAgICovXG4gIHRpdGxlOiBQcm9wVHlwZXMubm9kZSxcblxuICAvKipcbiAgICogRGVzY3JpcHRpb24gb2YgdGhlIGFsZXJ0LlxuICAgKi9cbiAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIHNob3cgYSBjbG9zZSBpY29uIGJ1dHRvbiBpbnNpZGUgb2YgdGhlIHRvYXN0LlxuICAgKi9cbiAgaGFzQ2xvc2VCdXR0b246IFByb3BUeXBlcy5ib29sLFxuXG4gIC8qKlxuICAgKiBXaGVuIGZhbHNlLCB3aWxsIGNsb3NlIHRoZSBUb2FzdCBhbmQgY2FsbCBvblJlbW92ZSB3aGVuIGZpbmlzaGVkLlxuICAgKi9cbiAgaXNTaG93bjogUHJvcFR5cGVzLmJvb2xcbn1cblxuZXhwb3J0IGRlZmF1bHQgVG9hc3RcbiJdfQ==