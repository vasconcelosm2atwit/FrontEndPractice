"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _layers = require("../../layers");

var _MenuItem = _interopRequireDefault(require("./MenuItem"));

var _MenuDivider = _interopRequireDefault(require("./MenuDivider"));

var _MenuGroup = _interopRequireDefault(require("./MenuGroup"));

var _MenuOption = _interopRequireDefault(require("./MenuOption"));

var _MenuOptionsGroup = _interopRequireDefault(require("./MenuOptionsGroup"));

var Menu = (0, _react.memo)(function Menu(props) {
  var menuRef = (0, _react.useRef)(null);
  var firstItem = (0, _react.useRef)();
  var lastItem = (0, _react.useRef)();
  var menuItems = (0, _react.useRef)();
  (0, _react.useEffect)(function () {
    var currentMenuRef = menuRef.current;
    menuItems.current = currentMenuRef ? (0, _toConsumableArray2["default"])(currentMenuRef.querySelectorAll('[role="menuitemradio"]:not([disabled]), [role="menuitem"]:not([disabled])')) : [];

    if (menuItems.current.length === 0) {
      throw new Error('The menu has no menu items');
    }

    firstItem.current = menuItems.current[0];
    lastItem.current = menuItems.current[menuItems.current.length - 1]; // Go to next/previous item if it exists
    // or loop around

    var focusNext = function focusNext(currentItem, startItem) {
      // Determine which item is the startItem (first or last)
      var goingDown = startItem === firstItem.current; // Helper function for getting next legitimate element

      var move = function move(elem) {
        var indexOfItem = menuItems.current.indexOf(elem);

        if (goingDown) {
          if (indexOfItem < menuItems.current.length - 1) {
            return menuItems.current[indexOfItem + 1];
          }

          return startItem;
        }

        if (indexOfItem - 1 > -1) {
          return menuItems.current[indexOfItem - 1];
        }

        return startItem;
      }; // Make first move


      var nextItem = move(currentItem); // Focus the first one that's not disabled

      nextItem.focus();
    };

    function onKeyPressListener(e) {
      var target = e.target;
      var menuItem = menuItems.current && menuItems.current.find(function (item) {
        return item === target;
      });

      if (!menuItem) {
        return;
      }

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        focusNext(menuItem, firstItem.current);
      }

      if (e.key === 'ArrowUp') {
        e.preventDefault();
        focusNext(menuItem, lastItem.current);
      }

      if (e.key === 'Home') {
        e.preventDefault();
        firstItem.current.focus();
      }

      if (e.key === 'End') {
        e.preventDefault();
        lastItem.current.focus();
      }
    }

    currentMenuRef.addEventListener('keydown', onKeyPressListener);
    return function () {
      currentMenuRef.removeEventListener('keydown', onKeyPressListener);
    };
  }, [menuRef]);
  var children = props.children;
  return _react["default"].createElement(_layers.Pane, {
    is: "nav",
    ref: menuRef,
    role: "menu",
    outline: "none"
  }, children);
});
Menu.Item = _MenuItem["default"];
Menu.Divider = _MenuDivider["default"];
Menu.Group = _MenuGroup["default"];
Menu.Divider = _MenuDivider["default"];
Menu.Group = _MenuGroup["default"];
Menu.Option = _MenuOption["default"];
Menu.OptionsGroup = _MenuOptionsGroup["default"];
Menu.propTypes = {
  /**
   * The children of the component.
   */
  children: _propTypes["default"].node
};
var _default = Menu;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tZW51L3NyYy9NZW51LmpzIl0sIm5hbWVzIjpbIk1lbnUiLCJwcm9wcyIsIm1lbnVSZWYiLCJmaXJzdEl0ZW0iLCJsYXN0SXRlbSIsIm1lbnVJdGVtcyIsImN1cnJlbnRNZW51UmVmIiwiY3VycmVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJsZW5ndGgiLCJFcnJvciIsImZvY3VzTmV4dCIsImN1cnJlbnRJdGVtIiwic3RhcnRJdGVtIiwiZ29pbmdEb3duIiwibW92ZSIsImVsZW0iLCJpbmRleE9mSXRlbSIsImluZGV4T2YiLCJuZXh0SXRlbSIsImZvY3VzIiwib25LZXlQcmVzc0xpc3RlbmVyIiwiZSIsInRhcmdldCIsIm1lbnVJdGVtIiwiZmluZCIsIml0ZW0iLCJrZXkiLCJwcmV2ZW50RGVmYXVsdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY2hpbGRyZW4iLCJJdGVtIiwiTWVudUl0ZW0iLCJEaXZpZGVyIiwiTWVudURpdmlkZXIiLCJHcm91cCIsIk1lbnVHcm91cCIsIk9wdGlvbiIsIk1lbnVPcHRpb24iLCJPcHRpb25zR3JvdXAiLCJNZW51T3B0aW9uc0dyb3VwIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwibm9kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQU1BLElBQUksR0FBRyxpQkFBSyxTQUFTQSxJQUFULENBQWNDLEtBQWQsRUFBcUI7QUFFckMsTUFBTUMsT0FBTyxHQUFHLG1CQUFPLElBQVAsQ0FBaEI7QUFDQSxNQUFNQyxTQUFTLEdBQUcsb0JBQWxCO0FBQ0EsTUFBTUMsUUFBUSxHQUFHLG9CQUFqQjtBQUVBLE1BQU1DLFNBQVMsR0FBRyxvQkFBbEI7QUFFQSx3QkFBVSxZQUFNO0FBRWQsUUFBTUMsY0FBYyxHQUFHSixPQUFPLENBQUNLLE9BQS9CO0FBRUFGLElBQUFBLFNB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Q0FBaUJhLEtBQWpCO0FBQ0Q7QUFDRjs7QUFFRGQsSUFBQUEsY0FBYyxDQUFDdUIsZ0JBQWYsQ0FBZ0MsU0FBaEMsRUFBMkNSLGtCQUEzQztBQUVBLFdBQU8sWUFBTTtBQUNYZixNQUFBQSxjQUFjLENBQUN3QixtQkFBZixDQUFtQyxTQUFuQyxFQUE4Q1Qsa0JBQTlDO0FBQ0QsS0FGRDtBQUdELEdBckZELEVBcUZHLENBQUNuQixPQUFELENBckZIO0FBUnFDLE1BK0Y3QjZCLFFBL0Y2QixHQStGaEI5QixLQS9GZ0IsQ0ErRjdCOEIsUUEvRjZCO0FBZ0dyQyxTQUNFLGdDQUFDLFlBQUQ7QUFBTSxJQUFBLEVBQUUsRUFBQyxLQUFUO0FBQWUsSUFBQSxHQUFHLEVBQUU3QixPQUFwQjtBQUE2QixJQUFBLElBQUksRUFBQyxNQUFsQztBQUF5QyxJQUFBLE9BQU8sRUFBQztBQUFqRCxLQUNHNkIsUUFESCxDQURGO0FBS0QsQ0FyR1ksQ0FBYjtBQXVHQS9CLElBQUksQ0FBQ2dDLElBQUwsR0FBWUMsb0JBQVo7QUFDQWpDLElBQUksQ0FBQ2tDLE9BQUwsR0FBZUMsdUJBQWY7QUFDQW5DLElBQUksQ0FBQ29DLEtBQUwsR0FBYUMscUJBQWI7QUFDQXJDLElBQUksQ0FBQ2tDLE9BQUwsR0FBZUMsdUJBQWY7QUFDQW5DLElBQUksQ0FBQ29DLEtBQUwsR0FBYUMscUJBQWI7QUFDQXJDLElBQUksQ0FBQ3NDLE1BQUwsR0FBY0Msc0JBQWQ7QUFDQXZDLElBQUksQ0FBQ3dDLFlBQUwsR0FBb0JDLDRCQUFwQjtBQUVBekMsSUFBSSxDQUFDMEMsU0FBTCxHQUFpQjtBQUNmOzs7QUFHQVgsRUFBQUEsUUFBUSxFQUFFWSxzQkFBVUM7QUFKTCxDQUFqQjtlQU9lNUMsSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBtZW1vLCB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgUGFuZSB9IGZyb20gJy4uLy4uL2xheWVycydcbmltcG9ydCBNZW51SXRlbSBmcm9tICcuL01lbnVJdGVtJ1xuaW1wb3J0IE1lbnVEaXZpZGVyIGZyb20gJy4vTWVudURpdmlkZXInXG5pbXBvcnQgTWVudUdyb3VwIGZyb20gJy4vTWVudUdyb3VwJ1xuaW1wb3J0IE1lbnVPcHRpb24gZnJvbSAnLi9NZW51T3B0aW9uJ1xuaW1wb3J0IE1lbnVPcHRpb25zR3JvdXAgZnJvbSAnLi9NZW51T3B0aW9uc0dyb3VwJ1xuXG5jb25zdCBNZW51ID0gbWVtbyhmdW5jdGlvbiBNZW51KHByb3BzKSB7XG5cbiAgY29uc3QgbWVudVJlZiA9IHVzZVJlZihudWxsKVxuICBjb25zdCBmaXJzdEl0ZW0gPSB1c2VSZWYoKVxuICBjb25zdCBsYXN0SXRlbSA9IHVzZVJlZigpXG5cbiAgY29uc3QgbWVudUl0ZW1zID0gdXNlUmVmKClcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuXG4gICAgY29uc3QgY3VycmVudE1lbnVSZWYgPSBtZW51UmVmLmN1cnJlbnRcblxuICAgIG1lbnVJdGVtcy5jdXJyZW50ID0gY3VycmVudE1lbnVSZWYgPyBbXG4gICAgICAuLi5jdXJyZW50TWVudVJlZi5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAnW3JvbGU9XCJtZW51aXRlbXJhZGlvXCJdOm5vdChbZGlzYWJsZWRdKSwgW3JvbGU9XCJtZW51aXRlbVwiXTpub3QoW2Rpc2FibGVkXSknXG4gICAgICldXG4gICAgOiBbXVxuXG4gICAgaWYgKG1lbnVJdGVtcy5jdXJyZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgbWVudSBoYXMgbm8gbWVudSBpdGVtcycpXG4gICAgfVxuXG4gICAgZmlyc3RJdGVtLmN1cnJlbnQgPSBtZW51SXRlbXMuY3VycmVudFswXVxuICAgIGxhc3RJdGVtLmN1cnJlbnQgPSBtZW51SXRlbXMuY3VycmVudFttZW51SXRlbXMuY3VycmVudC5sZW5ndGggLSAxXVxuXG4gICAgLy8gR28gdG8gbmV4dC9wcmV2aW91cyBpdGVtIGlmIGl0IGV4aXN0c1xuICAgIC8vIG9yIGxvb3AgYXJvdW5kXG4gICAgY29uc3QgZm9jdXNOZXh0ID0gKGN1cnJlbnRJdGVtLCBzdGFydEl0ZW0pID0+IHtcblxuICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGl0ZW0gaXMgdGhlIHN0YXJ0SXRlbSAoZmlyc3Qgb3IgbGFzdClcbiAgICAgIGNvbnN0IGdvaW5nRG93biA9IHN0YXJ0SXRlbSA9PT0gZmlyc3RJdGVtLmN1cnJlbnRcblxuICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIGZvciBnZXR0aW5nIG5leHQgbGVnaXRpbWF0ZSBlbGVtZW50XG4gICAgICBjb25zdCBtb3ZlID0gZWxlbSA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4T2ZJdGVtID0gbWVudUl0ZW1zLmN1cnJlbnQuaW5kZXhPZihlbGVtKVxuXG4gICAgICAgIGlmIChnb2luZ0Rvd24pIHtcbiAgICAgICAgICBpZiAoaW5kZXhPZkl0ZW0gPCBtZW51SXRlbXMuY3VycmVudC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVudUl0ZW1zLmN1cnJlbnRbaW5kZXhPZkl0ZW0gKyAxXVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBzdGFydEl0ZW1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbmRleE9mSXRlbSAtIDEgPiAtMSkge1xuICAgICAgICAgIHJldHVybiBtZW51SXRlbXMuY3VycmVudFtpbmRleE9mSXRlbSAtIDFdXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3RhcnRJdGVtXG4gICAgICB9XG5cbiAgICAgIC8vIE1ha2UgZmlyc3QgbW92ZVxuICAgICAgY29uc3QgbmV4dEl0ZW0gPSBtb3ZlKGN1cnJlbnRJdGVtKVxuXG4gICAgICAvLyBGb2N1cyB0aGUgZmlyc3Qgb25lIHRoYXQncyBub3QgZGlzYWJsZWRcbiAgICAgIG5leHRJdGVtLmZvY3VzKClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbktleVByZXNzTGlzdGVuZXIoZSkge1xuXG4gICAgICBjb25zdCB7IHRhcmdldCB9ID0gZVxuICAgICAgY29uc3QgbWVudUl0ZW0gPSBtZW51SXRlbXMuY3VycmVudCAmJiBtZW51SXRlbXMuY3VycmVudC5maW5kKChpdGVtKSA9PiBpdGVtID09PSB0YXJnZXQpXG5cbiAgICAgIGlmKCFtZW51SXRlbSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgaWYgKGUua2V5ID09PSAnQXJyb3dEb3duJykge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgZm9jdXNOZXh0KG1lbnVJdGVtLCBmaXJzdEl0ZW0uY3VycmVudClcbiAgICAgIH1cblxuICAgICAgaWYgKGUua2V5ID09PSAnQXJyb3dVcCcpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIGZvY3VzTmV4dChtZW51SXRlbSwgbGFzdEl0ZW0uY3VycmVudClcbiAgICAgIH1cblxuICAgICAgaWYgKGUua2V5ID09PSAnSG9tZScpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIGZpcnN0SXRlbS5jdXJyZW50LmZvY3VzKClcbiAgICAgIH1cblxuICAgICAgaWYgKGUua2V5ID09PSAnRW5kJykge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgbGFzdEl0ZW0uY3VycmVudC5mb2N1cygpXG4gICAgICB9XG4gICAgfVxuXG4gICAgY3VycmVudE1lbnVSZWYuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5UHJlc3NMaXN0ZW5lcilcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjdXJyZW50TWVudVJlZi5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlQcmVzc0xpc3RlbmVyKVxuICAgIH1cbiAgfSwgW21lbnVSZWZdKVxuXG4gIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHByb3BzXG4gIHJldHVybiAoXG4gICAgPFBhbmUgaXM9XCJuYXZcIiByZWY9e21lbnVSZWZ9IHJvbGU9XCJtZW51XCIgb3V0bGluZT1cIm5vbmVcIj5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L1BhbmU+XG4gIClcbn0pXG5cbk1lbnUuSXRlbSA9IE1lbnVJdGVtXG5NZW51LkRpdmlkZXIgPSBNZW51RGl2aWRlclxuTWVudS5Hcm91cCA9IE1lbnVHcm91cFxuTWVudS5EaXZpZGVyID0gTWVudURpdmlkZXJcbk1lbnUuR3JvdXAgPSBNZW51R3JvdXBcbk1lbnUuT3B0aW9uID0gTWVudU9wdGlvblxuTWVudS5PcHRpb25zR3JvdXAgPSBNZW51T3B0aW9uc0dyb3VwXG5cbk1lbnUucHJvcFR5cGVzID0ge1xuICAvKipcbiAgICogVGhlIGNoaWxkcmVuIG9mIHRoZSBjb21wb25lbnQuXG4gICAqL1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGVcbn1cblxuZXhwb3J0IGRlZmF1bHQgTWVudVxuIl19