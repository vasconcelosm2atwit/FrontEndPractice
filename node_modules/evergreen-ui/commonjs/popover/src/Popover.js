"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _glamor = require("glamor");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _positioner = require("../../positioner");

var _tooltip = require("../../tooltip");

var _constants = require("../../constants");

var _hooks = require("../../hooks");

var _PopoverStateless = _interopRequireDefault(require("./PopoverStateless"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var noop = function noop() {};

var emptyProps = {};
var Popover = (0, _react.memo)((0, _react.forwardRef)(function Popover(_ref, forwardedRef) {
  var _ref$animationDuratio = _ref.animationDuration,
      animationDuration = _ref$animationDuratio === void 0 ? 300 : _ref$animationDuratio,
      _ref$bringFocusInside = _ref.bringFocusInside,
      shouldBringFocusInside = _ref$bringFocusInside === void 0 ? false : _ref$bringFocusInside,
      children = _ref.children,
      content = _ref.content,
      display = _ref.display,
      _ref$minHeight = _ref.minHeight,
      minHeight = _ref$minHeight === void 0 ? 40 : _ref$minHeight,
      _ref$minWidth = _ref.minWidth,
      minWidth = _ref$minWidth === void 0 ? 200 : _ref$minWidth,
      _ref$onBodyClick = _ref.onBodyClick,
      onBodyClick = _ref$onBodyClick === void 0 ? noop : _ref$onBodyClick,
      _ref$onClose = _ref.onClose,
      onClose = _ref$onClose === void 0 ? noop : _ref$onClose,
      _ref$onCloseComplete = _ref.onCloseComplete,
      onCloseComplete = _ref$onCloseComplete === void 0 ? noop : _ref$onCloseComplete,
      _ref$onOpen = _ref.onOpen,
      onOpen = _ref$onOpen === void 0 ? noop : _ref$onOpen,
      _ref$onOpenComplete = _ref.onOpenComplete,
      onOpenComplete = _ref$onOpenComplete === void 0 ? noop : _ref$onOpenComplete,
      _ref$position = _ref.position,
      position = _ref$position === void 0 ? _constants.Position.BOTTOM : _ref$position,
      _ref$shouldCloseOnExt = _ref.shouldCloseOnExternalClick,
      shouldCloseOnExternalClick = _ref$shouldCloseOnExt === void 0 ? true : _ref$shouldCloseOnExt,
      _ref$statelessProps = _ref.statelessProps,
      statelessProps = _ref$statelessProps === void 0 ? emptyProps : _ref$statelessProps,
      _ref$trigger = _ref.trigger,
      trigger = _ref$trigger === void 0 ? 'click' : _ref$trigger,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["animationDuration", "bringFocusInside", "children", "content", "display", "minHeight", "minWidth", "onBodyClick", "onClose", "onCloseComplete", "onOpen", "onOpenComplete", "position", "shouldCloseOnExternalClick", "statelessProps", "trigger"]);

  var _useState = (0, _react.useState)(props.isShown),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var popoverNode = (0, _react.useRef)();
  var setPopoverNode = (0, _hooks.useMergedRef)(popoverNode);
  var targetRef = (0, _react.useRef)();
  var setTargetRef = (0, _hooks.useMergedRef)(targetRef);
  (0, _react.useImperativeHandle)(forwardedRef, function () {
    return {
      open: open,
      close: close
    };
  }, [popoverNode.current]);
  /**
   * Methods borrowed from BlueprintJS
   * https://github.com/palantir/blueprint/blob/release/2.0.0/packages/core/src/components/overlay/overlay.tsx
   */

  var bringFocusInside = (0, _react.useCallback)(function (e) {
    if (isShown && e) {
      e.preventDefault();
    } // Always delay focus manipulation to just before repaint to prevent scroll jumping


    return requestAnimationFrame(function () {
      // Container ref may be undefined between component mounting and Portal rendering
      // ActiveElement may be undefined in some rare cases in IE
      if (popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null || // eslint-disable-line eqeqeq, no-eq-null
      !isShown) {
        return;
      }

      var isFocusOutsideModal = !popoverNode.current.contains(document.activeElement);

      if (isFocusOutsideModal) {
        // Element marked autofocus has higher priority than the other elements
        var autofocusElement = popoverNode.current.querySelector('[autofocus]:not([disabled])');

        if (autofocusElement) {
          // Return early to avoid unnecessary dom queries
          return autofocusElement.focus();
        }

        var wrapperElement = popoverNode.current.querySelector('[tabindex]:not([disabled])');

        if (wrapperElement) {
          return wrapperElement.focus();
        }

        var buttonElements = popoverNode.current.querySelectorAll('button:not([disabled]), a:not([disabled]), [role="menuitem"]:not([disabled]), [role="menuitemradio"]:not([disabled])');

        if (buttonElements.length > 0) {
          return buttonElements[0].focus();
        }
      }
    });
  }, [isShown, popoverNode.current]);
  var bringFocusBackToTarget = (0, _react.useCallback)(function () {
    return requestAnimationFrame(function () {
      if (targetRef.current == null || // eslint-disable-line eqeqeq, no-eq-null
      popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null // eslint-disable-line eqeqeq, no-eq-null
      ) {
          return;
        }

      var isFocusInsideModal = popoverNode.current.contains(document.activeElement); // Bring back focus on the target.

      if (document.activeElement === document.body || isFocusInsideModal) {
        targetRef.current.focus();
      }
    });
  }, [popoverNode.current, targetRef.current]);
  var open = (0, _react.useCallback)(function () {
    if (isShown) {
      return;
    }

    setIsShown(true);
    onOpen();
  }, [setIsShown, onOpen, isShown]);
  var close = (0, _react.useCallback)(function () {
    if (!isShown) {
      return;
    }

    setIsShown(false);
    bringFocusBackToTarget();
    onClose();
  }, [setIsShown, bringFocusBackToTarget, onClose, isShown]); // If `props.isShown` is a boolean, treat as a controlled component
  // `open` and `close` should be applied when it changes

  (0, _react.useEffect)(function () {
    if (typeof props.isShown !== 'boolean' || props.isShown === isShown) {
      return;
    }

    if (props.isShown) {
      open();
    } else {
      close();
    }
  }, [props.isShown, isShown]);
  var toggle = (0, _react.useCallback)(function () {
    return isShown ? close() : open();
  }, [isShown, close, open]);
  var handleOpenHover = (0, _react.useMemo)(function () {
    return trigger === 'hover' ? open : undefined;
  }, [trigger, open]);
  var handleCloseHover = (0, _react.useMemo)(function () {
    return trigger === 'hover' ? close : undefined;
  }, [trigger, close]);
  var handleKeyDown = (0, _react.useCallback)(function (event) {
    return event.key === 'ArrowDown' ? bringFocusInside(event) : undefined;
  }, [bringFocusInside]);
  var onEsc = (0, _react.useCallback)(function (event) {
    return event.key === 'Escape' ? close() : undefined;
  }, [close]);
  var handleBodyClick = (0, _react.useCallback)(function (event) {
    // Ignore clicks on the popover or button
    if (targetRef.current && targetRef.current.contains(event.target)) {
      return;
    }

    if (popoverNode.current && popoverNode.current.contains(event.target)) {
      return;
    } // Notify body click


    onBodyClick(event);

    if (shouldCloseOnExternalClick !== false) {
      close();
    }
  }, [onBodyClick, shouldCloseOnExternalClick, close, targetRef.current, popoverNode.current]);
  var handleOpenComplete = (0, _react.useCallback)(function () {
    if (shouldBringFocusInside) bringFocusInside();
    onOpenComplete();
  }, [shouldBringFocusInside, bringFocusInside, onOpenComplete]);
  (0, _react.useEffect)(function () {
    if (isShown) {
      document.body.addEventListener('click', handleBodyClick, false);
      document.body.addEventListener('keydown', onEsc, false);
    } else {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    }

    return function () {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    };
  }, [isShown, handleBodyClick, onEsc]);
  var renderTarget = (0, _react.useCallback)(function (_ref2) {
    var getRef = _ref2.getRef,
        isShown = _ref2.isShown;
    var isTooltipInside = children && children.type === _tooltip.Tooltip;

    var getTargetRef = function getTargetRef(ref) {
      setTargetRef(ref);
      getRef(ref);
    };
    /**
     * When a function is passed, you can control the Popover manually.
     */


    if (typeof children === 'function') {
      return children({
        getRef: getTargetRef,
        isShown: isShown,
        toggle: toggle
      });
    }

    var popoverTargetProps = {
      onClick: toggle,
      onMouseEnter: handleOpenHover,
      onKeyDown: handleKeyDown,
      role: 'button',
      'aria-expanded': isShown,
      'aria-haspopup': true
    };
    /**
     * Tooltips can be used within a Popover (not the other way around)
     * In this case the children is the Tooltip instead of a button.
     * Pass the properties to the Tooltip and let the Tooltip
     * add the properties to the target.
     */

    if (isTooltipInside) {
      return _react["default"].cloneElement(children, {
        popoverProps: _objectSpread({
          getTargetRef: getTargetRef,
          isShown: isShown
        }, popoverTargetProps)
      });
    }
    /**
     * With normal usage only popover props end up on the target.
     */


    return _react["default"].cloneElement(children, _objectSpread({
      ref: getTargetRef
    }, popoverTargetProps));
  }, [children, setTargetRef, toggle, handleOpenHover, handleKeyDown]); // If `props.isShown` is a boolean, popover is controlled manually, not via mouse events

  var shown = typeof props.isShown === 'boolean' ? props.isShown : isShown;
  var contentToRender = (0, _react.useMemo)(function () {
    return typeof content === 'function' ? content({
      close: close
    }) : content;
  }, [content, close]);
  return _react["default"].createElement(_positioner.Positioner, {
    target: renderTarget,
    isShown: shown,
    position: position,
    animationDuration: animationDuration,
    onOpenComplete: handleOpenComplete,
    onCloseComplete: onCloseComplete
  }, function (_ref3) {
    var css = _ref3.css,
        style = _ref3.style,
        state = _ref3.state,
        getRef = _ref3.getRef;
    return _react["default"].createElement(_PopoverStateless["default"], (0, _extends2["default"])({
      ref: function ref(_ref4) {
        setPopoverNode(_ref4);
        getRef(_ref4);
      },
      "data-state": state,
      display: display,
      minWidth: minWidth,
      minHeight: minHeight
    }, statelessProps, {
      className: (0, _classnames["default"])(statelessProps.className, (0, _glamor.css)(css, style, statelessProps.style).toString()) // Overwrite `statelessProps.style` since we are including it via className
      ,
      style: undefined,
      onMouseLeave: handleCloseHover
    }), contentToRender);
  });
}));
Popover.propTypes = {
  /**
   * The position the Popover is on. Smart positioning might override this.
   */
  position: _propTypes["default"].oneOf([_constants.Position.TOP, _constants.Position.TOP_LEFT, _constants.Position.TOP_RIGHT, _constants.Position.BOTTOM, _constants.Position.BOTTOM_LEFT, _constants.Position.BOTTOM_RIGHT, _constants.Position.LEFT, _constants.Position.RIGHT]),

  /**
   * When true, the Popover is manually shown.
   */
  isShown: _propTypes["default"].bool,

  /**
   * Open the Popover based on click or hover. Default is click.
   */
  trigger: _propTypes["default"].oneOf(['click', 'hover']),

  /**
   * The content of the Popover.
   */
  content: _propTypes["default"].oneOfType([_propTypes["default"].node, _propTypes["default"].func]).isRequired,

  /**
   * The target button of the Popover.
   * When a function the following arguments are passed:
   * ({ toggle: Function -> Void, getRef: Function -> Ref, isShown: Bool })
   */
  children: _propTypes["default"].oneOfType([_propTypes["default"].element, _propTypes["default"].func]).isRequired,

  /**
   * The display property passed to the Popover card.
   */
  display: _propTypes["default"].string,

  /**
   * The min width of the Popover card.
   */
  minWidth: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]),

  /**
   * The min height of the Popover card.
   */
  minHeight: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]),

  /**
   * Properties passed through to the Popover card.
   */
  statelessProps: _propTypes["default"].shape(_PopoverStateless["default"].propTypes),

  /**
   * Duration of the animation.
   */
  animationDuration: _propTypes["default"].number,

  /**
   * Function called when the Popover opens.
   */
  onOpen: _propTypes["default"].func,

  /**
   * Function fired when Popover closes.
   */
  onClose: _propTypes["default"].func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: _propTypes["default"].func,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: _propTypes["default"].func,

  /**
   * Function that will be called when the body is clicked.
   */
  onBodyClick: _propTypes["default"].func,

  /**
   * When true, bring focus inside of the Popover on open.
   */
  bringFocusInside: _propTypes["default"].bool,

  /**
   * Boolean indicating if clicking outside the dialog should close the dialog.
   */
  shouldCloseOnExternalClick: _propTypes["default"].bool
};
var _default = Popover;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3BvdmVyL3NyYy9Qb3BvdmVyLmpzIl0sIm5hbWVzIjpbIm5vb3AiLCJlbXB0eVByb3BzIiwiUG9wb3ZlciIsImZvcndhcmRlZFJlZiIsImFuaW1hdGlvbkR1cmF0aW9uIiwiYnJpbmdGb2N1c0luc2lkZSIsInNob3VsZEJyaW5nRm9jdXNJbnNpZGUiLCJjaGlsZHJlbiIsImNvbnRlbnQiLCJkaXNwbGF5IiwibWluSGVpZ2h0IiwibWluV2lkdGgiLCJvbkJvZHlDbGljayIsIm9uQ2xvc2UiLCJvbkNsb3NlQ29tcGxldGUiLCJvbk9wZW4iLCJvbk9wZW5Db21wbGV0ZSIsInBvc2l0aW9uIiwiUG9zaXRpb24iLCJCT1RUT00iLCJzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayIsInN0YXRlbGVzc1Byb3BzIiwidHJpZ2dlciIsInByb3BzIiwiaXNTaG93biIsInNldElzU2hvd24iLCJwb3BvdmVyTm9kZSIsInNldFBvcG92ZXJOb2RlIiwidGFyZ2V0UmVmIiwic2V0VGFyZ2V0UmVmIiwib3BlbiIsImNsb3NlIiwiY3VycmVudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImlzRm9jdXNPdXRzaWRlTW9kYWwiLCJjb250YWlucyIsImF1dG9mb2N1c0VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJ3cmFwcGVyRWxlbWVudCIsImJ1dHRvbkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImJyaW5nRm9jdXNCYWNrVG9UYXJnZXQiLCJpc0ZvY3VzSW5zaWRlTW9kYWwiLCJib2R5IiwidG9nZ2xlIiwiaGFuZGxlT3BlbkhvdmVyIiwidW5kZWZpbmVkIiwiaGFuZGxlQ2xvc2VIb3ZlciIsImhhbmRsZUtleURvd24iLCJldmVudCIsImtleSIsIm9uRXNjIiwiaGFuZGxlQm9keUNsaWNrIiwidGFyZ2V0IiwiaGFuZGxlT3BlbkNvbXBsZXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJUYXJnZXQiLCJnZXRSZWYiLCJpc1Rvb2x0aXBJbnNpZGUiLCJ0eXBlIiwiVG9vbHRpcCIsImdldFRhcmdldFJlZiIsInJlZiIsInBvcG92ZXJUYXJnZXRQcm9wcyIsIm9uQ2xpY2siLCJvbk1vdXNlRW50ZXIiLCJvbktleURvd24iLCJyb2xlIiwiUmVhY3QiLCJjbG9uZUVsZW1lbnQiLCJwb3BvdmVyUHJvcHMiLCJzaG93biIsImNvbnRlbnRUb1JlbmRlciIsImNzcyIsInN0eWxlIiwic3RhdGUiLCJjbGFzc05hbWUiLCJ0b1N0cmluZyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9uZU9mIiwiVE9QIiwiVE9QX0xFRlQiLCJUT1BfUklHSFQiLCJCT1RUT01fTEVGVCIsIkJPVFRPTV9SSUdIVCIsIkxFRlQiLCJSSUdIVCIsImJvb2wiLCJvbmVPZlR5cGUiLCJub2RlIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJlbGVtZW50Iiwic3RyaW5nIiwibnVtYmVyIiwic2hhcGUiLCJQb3BvdmVyU3RhdGVsZXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBVUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLElBQU1BLElBQUksR0FBRyxTQUFQQSxJQUFPLEdBQU0sQ0FBRSxDQUFyQjs7QUFDQSxJQUFNQyxVQUFVLEdBQUcsRUFBbkI7QUFFQSxJQUFNQyxPQUFPLEdBQUcsaUJBQ2QsdUJBQVcsU0FBU0EsT0FBVCxPQW9CVEMsWUFwQlMsRUFxQlQ7QUFBQSxtQ0FuQkVDLGlCQW1CRjtBQUFBLE1BbkJFQSxpQkFtQkYsc0NBbkJzQixHQW1CdEI7QUFBQSxtQ0FsQkVDLGdCQWtCRjtBQUFBLE1BbEJvQkMsc0JBa0JwQixzQ0FsQjZDLEtBa0I3QztBQUFBLE1BakJFQyxRQWlCRixRQWpCRUEsUUFpQkY7QUFBQSxNQWhCRUMsT0FnQkYs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OztBQW1EbEI7OztBQUdBaEYsRUFBQUEsY0FBYyxFQUFFaUUsc0JBQVVpQixLQUFWLENBQWdCQyw2QkFBaUJuQixTQUFqQyxDQXRERTs7QUF3RGxCOzs7QUFHQWpGLEVBQUFBLGlCQUFpQixFQUFFa0Ysc0JBQVVnQixNQTNEWDs7QUE2RGxCOzs7QUFHQXZGLEVBQUFBLE1BQU0sRUFBRXVFLHNCQUFVWSxJQWhFQTs7QUFrRWxCOzs7QUFHQXJGLEVBQUFBLE9BQU8sRUFBRXlFLHNCQUFVWSxJQXJFRDs7QUF1RWxCOzs7QUFHQWxGLEVBQUFBLGNBQWMsRUFBRXNFLHNCQUFVWSxJQTFFUjs7QUE0RWxCOzs7QUFHQXBGLEVBQUFBLGVBQWUsRUFBRXdFLHNCQUFVWSxJQS9FVDs7QUFpRmxCOzs7QUFHQXRGLEVBQUFBLFdBQVcsRUFBRTBFLHNCQUFVWSxJQXBGTDs7QUFzRmxCOzs7QUFHQTdGLEVBQUFBLGdCQUFnQixFQUFFaUYsc0JBQVVTLElBekZWOztBQTJGbEI7OztBQUdBM0UsRUFBQUEsMEJBQTBCLEVBQUVrRSxzQkFBVVM7QUE5RnBCLENBQXBCO2VBaUdlN0YsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xuICBtZW1vLFxuICBmb3J3YXJkUmVmLFxuICB1c2VSZWYsXG4gIHVzZVN0YXRlLFxuICB1c2VFZmZlY3QsXG4gIHVzZUltcGVyYXRpdmVIYW5kbGUsXG4gIHVzZUNhbGxiYWNrLFxuICB1c2VNZW1vXG59IGZyb20gJ3JlYWN0J1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnXG5pbXBvcnQgeyBjc3MgYXMgZ2xhbW9yQ3NzIH0gZnJvbSAnZ2xhbW9yJ1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgUG9zaXRpb25lciB9IGZyb20gJy4uLy4uL3Bvc2l0aW9uZXInXG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnLi4vLi4vdG9vbHRpcCdcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgdXNlTWVyZ2VkUmVmIH0gZnJvbSAnLi4vLi4vaG9va3MnXG5pbXBvcnQgUG9wb3ZlclN0YXRlbGVzcyBmcm9tICcuL1BvcG92ZXJTdGF0ZWxlc3MnXG5cbmNvbnN0IG5vb3AgPSAoKSA9PiB7fVxuY29uc3QgZW1wdHlQcm9wcyA9IHt9XG5cbmNvbnN0IFBvcG92ZXIgPSBtZW1vKFxuICBmb3J3YXJkUmVmKGZ1bmN0aW9uIFBvcG92ZXIoXG4gICAge1xuICAgICAgYW5pbWF0aW9uRHVyYXRpb24gPSAzMDAsXG4gICAgICBicmluZ0ZvY3VzSW5zaWRlOiBzaG91bGRCcmluZ0ZvY3VzSW5zaWRlID0gZmFsc2UsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIGNvbnRlbnQsXG4gICAgICBkaXNwbGF5LFxuICAgICAgbWluSGVpZ2h0ID0gNDAsXG4gICAgICBtaW5XaWR0aCA9IDIwMCxcbiAgICAgIG9uQm9keUNsaWNrID0gbm9vcCxcbiAgICAgIG9uQ2xvc2UgPSBub29wLFxuICAgICAgb25DbG9zZUNvbXBsZXRlID0gbm9vcCxcbiAgICAgIG9uT3BlbiA9IG5vb3AsXG4gICAgICBvbk9wZW5Db21wbGV0ZSA9IG5vb3AsXG4gICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLkJPVFRPTSxcbiAgICAgIHNob3VsZENsb3NlT25FeHRlcm5hbENsaWNrID0gdHJ1ZSxcbiAgICAgIHN0YXRlbGVzc1Byb3BzID0gZW1wdHlQcm9wcyxcbiAgICAgIHRyaWdnZXIgPSAnY2xpY2snLFxuICAgICAgLi4ucHJvcHNcbiAgICB9LFxuICAgIGZvcndhcmRlZFJlZlxuICApIHtcbiAgICBjb25zdCBbaXNTaG93biwgc2V0SXNTaG93bl0gPSB1c2VTdGF0ZShwcm9wcy5pc1Nob3duKVxuICAgIGNvbnN0IHBvcG92ZXJOb2RlID0gdXNlUmVmKClcbiAgICBjb25zdCBzZXRQb3BvdmVyTm9kZSA9IHVzZU1lcmdlZFJlZihwb3BvdmVyTm9kZSlcbiAgICBjb25zdCB0YXJnZXRSZWYgPSB1c2VSZWYoKVxuICAgIGNvbnN0IHNldFRhcmdldFJlZiA9IHVzZU1lcmdlZFJlZih0YXJnZXRSZWYpXG5cbiAgICB1c2VJbXBlcmF0aXZlSGFuZGxlKFxuICAgICAgZm9yd2FyZGVkUmVmLFxuICAgICAgKCkgPT4gKHtcbiAgICAgICAgb3BlbixcbiAgICAgICAgY2xvc2VcbiAgICAgIH0pLFxuICAgICAgW3BvcG92ZXJOb2RlLmN1cnJlbnRdXG4gICAgKVxuXG4gICAgLyoqXG4gICAgICogTWV0aG9kcyBib3Jyb3dlZCBmcm9tIEJsdWVwcmludEpTXG4gICAgICogaHR0cHM6Ly9naXRodWIuY29tL3BhbGFudGlyL2JsdWVwcmludC9ibG9iL3JlbGVhc2UvMi4wLjAvcGFja2FnZXMvY29yZS9zcmMvY29tcG9uZW50cy9vdmVybGF5L292ZXJsYXkudHN4XG4gICAgICovXG4gICAgY29uc3QgYnJpbmdGb2N1c0luc2lkZSA9IHVzZUNhbGxiYWNrKChlKSA9PiB7XG4gICAgICBpZihpc1Nob3duICYmIGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICB9XG4gICAgICAvLyBBbHdheXMgZGVsYXkgZm9jdXMgbWFuaXB1bGF0aW9uIHRvIGp1c3QgYmVmb3JlIHJlcGFpbnQgdG8gcHJldmVudCBzY3JvbGwganVtcGluZ1xuXG4gICAgICByZXR1cm4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgLy8gQ29udGFpbmVyIHJlZiBtYXkgYmUgdW5kZWZpbmVkIGJldHdlZW4gY29tcG9uZW50IG1vdW50aW5nIGFuZCBQb3J0YWwgcmVuZGVyaW5nXG5cbiAgICAgICAgLy8gQWN0aXZlRWxlbWVudCBtYXkgYmUgdW5kZWZpbmVkIGluIHNvbWUgcmFyZSBjYXNlcyBpbiBJRVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBwb3BvdmVyTm9kZS5jdXJyZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICAhaXNTaG93blxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGlzRm9jdXNPdXRzaWRlTW9kYWwgPSAhcG9wb3Zlck5vZGUuY3VycmVudC5jb250YWlucyhcbiAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50XG4gICAgICAgIClcbiAgICAgICAgaWYgKGlzRm9jdXNPdXRzaWRlTW9kYWwpIHtcbiAgICAgICAgICAvLyBFbGVtZW50IG1hcmtlZCBhdXRvZm9jdXMgaGFzIGhpZ2hlciBwcmlvcml0eSB0aGFuIHRoZSBvdGhlciBlbGVtZW50c1xuICAgICAgICAgIGNvbnN0IGF1dG9mb2N1c0VsZW1lbnQgPSBwb3BvdmVyTm9kZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAnW2F1dG9mb2N1c106bm90KFtkaXNhYmxlZF0pJ1xuICAgICAgICAgIClcbiAgICAgICAgICBpZiAoYXV0b2ZvY3VzRWxlbWVudCkge1xuICAgICAgICAgICAgLy8gUmV0dXJuIGVhcmx5IHRvIGF2b2lkIHVubmVjZXNzYXJ5IGRvbSBxdWVyaWVzXG4gICAgICAgICAgICByZXR1cm4gYXV0b2ZvY3VzRWxlbWVudC5mb2N1cygpXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3Qgd3JhcHBlckVsZW1lbnQgPSBwb3BvdmVyTm9kZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IoJ1t0YWJpbmRleF06bm90KFtkaXNhYmxlZF0pJylcbiAgICAgICAgICBpZiAod3JhcHBlckVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB3cmFwcGVyRWxlbWVudC5mb2N1cygpXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgYnV0dG9uRWxlbWVudHMgPSBwb3BvdmVyTm9kZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKSwgYTpub3QoW2Rpc2FibGVkXSksIFtyb2xlPVwibWVudWl0ZW1cIl06bm90KFtkaXNhYmxlZF0pLCBbcm9sZT1cIm1lbnVpdGVtcmFkaW9cIl06bm90KFtkaXNhYmxlZF0pJ1xuICAgICAgICAgIClcbiAgICAgICAgICBpZiAoYnV0dG9uRWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbkVsZW1lbnRzWzBdLmZvY3VzKClcbiAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LCBbaXNTaG93biwgcG9wb3Zlck5vZGUuY3VycmVudF0pXG5cbiAgICBjb25zdCBicmluZ0ZvY3VzQmFja1RvVGFyZ2V0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgcmV0dXJuIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0YXJnZXRSZWYuY3VycmVudCA9PSBudWxsIHx8IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICAgcG9wb3Zlck5vZGUuY3VycmVudCA9PSBudWxsIHx8IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PSBudWxsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNGb2N1c0luc2lkZU1vZGFsID0gcG9wb3Zlck5vZGUuY3VycmVudC5jb250YWlucyhcbiAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50XG4gICAgICAgIClcblxuICAgICAgICAvLyBCcmluZyBiYWNrIGZvY3VzIG9uIHRoZSB0YXJnZXQuXG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBkb2N1bWVudC5ib2R5IHx8IGlzRm9jdXNJbnNpZGVNb2RhbCkge1xuICAgICAgICAgIHRhcmdldFJlZi5jdXJyZW50LmZvY3VzKClcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LCBbcG9wb3Zlck5vZGUuY3VycmVudCwgdGFyZ2V0UmVmLmN1cnJlbnRdKVxuXG4gICAgY29uc3Qgb3BlbiA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmIChpc1Nob3duKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBzZXRJc1Nob3duKHRydWUpXG4gICAgICBvbk9wZW4oKVxuICAgIH0sIFtzZXRJc1Nob3duLCBvbk9wZW4sIGlzU2hvd25dKVxuXG4gICAgY29uc3QgY2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAoIWlzU2hvd24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHNldElzU2hvd24oZmFsc2UpXG4gICAgICBicmluZ0ZvY3VzQmFja1RvVGFyZ2V0KClcbiAgICAgIG9uQ2xvc2UoKVxuICAgIH0sIFtzZXRJc1Nob3duLCBicmluZ0ZvY3VzQmFja1RvVGFyZ2V0LCBvbkNsb3NlLCBpc1Nob3duXSlcblxuICAgIC8vIElmIGBwcm9wcy5pc1Nob3duYCBpcyBhIGJvb2xlYW4sIHRyZWF0IGFzIGEgY29udHJvbGxlZCBjb21wb25lbnRcbiAgICAvLyBgb3BlbmAgYW5kIGBjbG9zZWAgc2hvdWxkIGJlIGFwcGxpZWQgd2hlbiBpdCBjaGFuZ2VzXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgcHJvcHMuaXNTaG93biAhPT0gJ2Jvb2xlYW4nIHx8IHByb3BzLmlzU2hvd24gPT09IGlzU2hvd24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wcy5pc1Nob3duKSB7XG4gICAgICAgIG9wZW4oKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xvc2UoKVxuICAgICAgfVxuICAgIH0sIFtwcm9wcy5pc1Nob3duLCBpc1Nob3duXSlcblxuICAgIGNvbnN0IHRvZ2dsZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHJldHVybiBpc1Nob3duID8gY2xvc2UoKSA6IG9wZW4oKVxuICAgIH0sIFtpc1Nob3duLCBjbG9zZSwgb3Blbl0pXG5cbiAgICBjb25zdCBoYW5kbGVPcGVuSG92ZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiB0cmlnZ2VyID09PSAnaG92ZXInID8gb3BlbiA6IHVuZGVmaW5lZFxuICAgIH0sIFt0cmlnZ2VyLCBvcGVuXSlcblxuICAgIGNvbnN0IGhhbmRsZUNsb3NlSG92ZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiB0cmlnZ2VyID09PSAnaG92ZXInID8gY2xvc2UgOiB1bmRlZmluZWRcbiAgICB9LCBbdHJpZ2dlciwgY2xvc2VdKVxuXG4gICAgY29uc3QgaGFuZGxlS2V5RG93biA9IHVzZUNhbGxiYWNrKChldmVudCkgPT4ge1xuICAgICAgcmV0dXJuIGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicgPyBicmluZ0ZvY3VzSW5zaWRlKGV2ZW50KSA6IHVuZGVmaW5lZFxuICAgIH0sIFticmluZ0ZvY3VzSW5zaWRlXSlcblxuICAgIGNvbnN0IG9uRXNjID0gdXNlQ2FsbGJhY2soKGV2ZW50KSA9PiB7XG4gICAgICByZXR1cm4gZXZlbnQua2V5ID09PSAnRXNjYXBlJyA/IGNsb3NlKCkgOiB1bmRlZmluZWRcbiAgICB9LCBbY2xvc2VdKVxuXG4gICAgY29uc3QgaGFuZGxlQm9keUNsaWNrID0gdXNlQ2FsbGJhY2soKGV2ZW50KSA9PiB7XG4gICAgICAvLyBJZ25vcmUgY2xpY2tzIG9uIHRoZSBwb3BvdmVyIG9yIGJ1dHRvblxuICAgICAgaWYgKHRhcmdldFJlZi5jdXJyZW50ICYmIHRhcmdldFJlZi5jdXJyZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIGlmIChwb3BvdmVyTm9kZS5jdXJyZW50ICYmIHBvcG92ZXJOb2RlLmN1cnJlbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgLy8gTm90aWZ5IGJvZHkgY2xpY2tcbiAgICAgIG9uQm9keUNsaWNrKGV2ZW50KVxuXG4gICAgICBpZiAoc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2sgIT09IGZhbHNlKSB7XG4gICAgICAgIGNsb3NlKClcbiAgICAgIH1cbiAgICB9LCBbb25Cb2R5Q2xpY2ssIHNob3VsZENsb3NlT25FeHRlcm5hbENsaWNrLCBjbG9zZSwgdGFyZ2V0UmVmLmN1cnJlbnQsIHBvcG92ZXJOb2RlLmN1cnJlbnRdKVxuXG4gICAgY29uc3QgaGFuZGxlT3BlbkNvbXBsZXRlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKHNob3VsZEJyaW5nRm9jdXNJbnNpZGUpIGJyaW5nRm9jdXNJbnNpZGUoKVxuICAgICAgb25PcGVuQ29tcGxldGUoKVxuICAgIH0sIFtzaG91bGRCcmluZ0ZvY3VzSW5zaWRlLCBicmluZ0ZvY3VzSW5zaWRlLCBvbk9wZW5Db21wbGV0ZV0pXG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKGlzU2hvd24pIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJvZHlDbGljaywgZmFsc2UpXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uRXNjLCBmYWxzZSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVCb2R5Q2xpY2ssIGZhbHNlKVxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbkVzYywgZmFsc2UpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVCb2R5Q2xpY2ssIGZhbHNlKVxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbkVzYywgZmFsc2UpXG4gICAgICB9XG4gICAgfSwgW2lzU2hvd24sIGhhbmRsZUJvZHlDbGljaywgb25Fc2NdKVxuXG4gICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gdXNlQ2FsbGJhY2soKHsgZ2V0UmVmLCBpc1Nob3duIH0pID0+IHtcbiAgICAgIGNvbnN0IGlzVG9vbHRpcEluc2lkZSA9IGNoaWxkcmVuICYmIGNoaWxkcmVuLnR5cGUgPT09IFRvb2x0aXBcblxuICAgICAgY29uc3QgZ2V0VGFyZ2V0UmVmID0gcmVmID0+IHtcbiAgICAgICAgc2V0VGFyZ2V0UmVmKHJlZilcbiAgICAgICAgZ2V0UmVmKHJlZilcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBXaGVuIGEgZnVuY3Rpb24gaXMgcGFzc2VkLCB5b3UgY2FuIGNvbnRyb2wgdGhlIFBvcG92ZXIgbWFudWFsbHkuXG4gICAgICAgKi9cbiAgICAgIGlmICh0eXBlb2YgY2hpbGRyZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIGNoaWxkcmVuKHtcbiAgICAgICAgICBnZXRSZWY6IGdldFRhcmdldFJlZixcbiAgICAgICAgICBpc1Nob3duLFxuICAgICAgICAgIHRvZ2dsZVxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICBjb25zdCBwb3BvdmVyVGFyZ2V0UHJvcHMgPSB7XG4gICAgICAgIG9uQ2xpY2s6IHRvZ2dsZSxcbiAgICAgICAgb25Nb3VzZUVudGVyOiBoYW5kbGVPcGVuSG92ZXIsXG4gICAgICAgIG9uS2V5RG93bjogaGFuZGxlS2V5RG93bixcbiAgICAgICAgcm9sZTogJ2J1dHRvbicsXG4gICAgICAgICdhcmlhLWV4cGFuZGVkJzogaXNTaG93bixcbiAgICAgICAgJ2FyaWEtaGFzcG9wdXAnOiB0cnVlXG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogVG9vbHRpcHMgY2FuIGJlIHVzZWQgd2l0aGluIGEgUG9wb3ZlciAobm90IHRoZSBvdGhlciB3YXkgYXJvdW5kKVxuICAgICAgICogSW4gdGhpcyBjYXNlIHRoZSBjaGlsZHJlbiBpcyB0aGUgVG9vbHRpcCBpbnN0ZWFkIG9mIGEgYnV0dG9uLlxuICAgICAgICogUGFzcyB0aGUgcHJvcGVydGllcyB0byB0aGUgVG9vbHRpcCBhbmQgbGV0IHRoZSBUb29sdGlwXG4gICAgICAgKiBhZGQgdGhlIHByb3BlcnRpZXMgdG8gdGhlIHRhcmdldC5cbiAgICAgICAqL1xuICAgICAgaWYgKGlzVG9vbHRpcEluc2lkZSkge1xuICAgICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkcmVuLCB7XG4gICAgICAgICAgcG9wb3ZlclByb3BzOiB7XG4gICAgICAgICAgICBnZXRUYXJnZXRSZWYsXG4gICAgICAgICAgICBpc1Nob3duLFxuXG4gICAgICAgICAgICAvLyBUaGVzZSBwcm9wZXRpZXMgd2lsbCBiZSBzcHJlYWQgYXMgYHBvcG92ZXJUYXJnZXRQcm9wc2BcbiAgICAgICAgICAgIC8vIGluIHRoZSBUb29sdGlwIGNvbXBvbmVudC5cbiAgICAgICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wc1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBXaXRoIG5vcm1hbCB1c2FnZSBvbmx5IHBvcG92ZXIgcHJvcHMgZW5kIHVwIG9uIHRoZSB0YXJnZXQuXG4gICAgICAgKi9cbiAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgICAgcmVmOiBnZXRUYXJnZXRSZWYsXG4gICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wc1xuICAgICAgfSlcbiAgICB9LCBbY2hpbGRyZW4sIHNldFRhcmdldFJlZiwgdG9nZ2xlLCBoYW5kbGVPcGVuSG92ZXIsIGhhbmRsZUtleURvd25dKVxuXG4gICAgLy8gSWYgYHByb3BzLmlzU2hvd25gIGlzIGEgYm9vbGVhbiwgcG9wb3ZlciBpcyBjb250cm9sbGVkIG1hbnVhbGx5LCBub3QgdmlhIG1vdXNlIGV2ZW50c1xuICAgIGNvbnN0IHNob3duID0gdHlwZW9mIHByb3BzLmlzU2hvd24gPT09ICdib29sZWFuJyA/IHByb3BzLmlzU2hvd24gOiBpc1Nob3duXG5cbiAgICBjb25zdCBjb250ZW50VG9SZW5kZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiB0eXBlb2YgY29udGVudCA9PT0gJ2Z1bmN0aW9uJyA/IGNvbnRlbnQoeyBjbG9zZSB9KSA6IGNvbnRlbnRcbiAgICB9LCBbY29udGVudCwgY2xvc2VdKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxQb3NpdGlvbmVyXG4gICAgICAgIHRhcmdldD17cmVuZGVyVGFyZ2V0fVxuICAgICAgICBpc1Nob3duPXtzaG93bn1cbiAgICAgICAgcG9zaXRpb249e3Bvc2l0aW9ufVxuICAgICAgICBhbmltYXRpb25EdXJhdGlvbj17YW5pbWF0aW9uRHVyYXRpb259XG4gICAgICAgIG9uT3BlbkNvbXBsZXRlPXtoYW5kbGVPcGVuQ29tcGxldGV9XG4gICAgICAgIG9uQ2xvc2VDb21wbGV0ZT17b25DbG9zZUNvbXBsZXRlfVxuICAgICAgPlxuICAgICAgICB7KHsgY3NzLCBzdHlsZSwgc3RhdGUsIGdldFJlZiB9KSA9PiAoXG4gICAgICAgICAgPFBvcG92ZXJTdGF0ZWxlc3NcbiAgICAgICAgICAgIHJlZj17cmVmID0+IHtcbiAgICAgICAgICAgICAgc2V0UG9wb3Zlck5vZGUocmVmKVxuICAgICAgICAgICAgICBnZXRSZWYocmVmKVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIGRhdGEtc3RhdGU9e3N0YXRlfVxuICAgICAgICAgICAgZGlzcGxheT17ZGlzcGxheX1cbiAgICAgICAgICAgIG1pbldpZHRoPXttaW5XaWR0aH1cbiAgICAgICAgICAgIG1pbkhlaWdodD17bWluSGVpZ2h0fVxuICAgICAgICAgICAgey4uLnN0YXRlbGVzc1Byb3BzfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjeChcbiAgICAgICAgICAgICAgc3RhdGVsZXNzUHJvcHMuY2xhc3NOYW1lLFxuICAgICAgICAgICAgICBnbGFtb3JDc3MoY3NzLCBzdHlsZSwgc3RhdGVsZXNzUHJvcHMuc3R5bGUpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICAvLyBPdmVyd3JpdGUgYHN0YXRlbGVzc1Byb3BzLnN0eWxlYCBzaW5jZSB3ZSBhcmUgaW5jbHVkaW5nIGl0IHZpYSBjbGFzc05hbWVcbiAgICAgICAgICAgIHN0eWxlPXt1bmRlZmluZWR9XG4gICAgICAgICAgICBvbk1vdXNlTGVhdmU9e2hhbmRsZUNsb3NlSG92ZXJ9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2NvbnRlbnRUb1JlbmRlcn1cbiAgICAgICAgICA8L1BvcG92ZXJTdGF0ZWxlc3M+XG4gICAgICAgICl9XG4gICAgICA8L1Bvc2l0aW9uZXI+XG4gICAgKVxuICB9KVxuKVxuXG5Qb3BvdmVyLnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFRoZSBwb3NpdGlvbiB0aGUgUG9wb3ZlciBpcyBvbi4gU21hcnQgcG9zaXRpb25pbmcgbWlnaHQgb3ZlcnJpZGUgdGhpcy5cbiAgICovXG4gIHBvc2l0aW9uOiBQcm9wVHlwZXMub25lT2YoW1xuICAgIFBvc2l0aW9uLlRPUCxcbiAgICBQb3NpdGlvbi5UT1BfTEVGVCxcbiAgICBQb3NpdGlvbi5UT1BfUklHSFQsXG4gICAgUG9zaXRpb24uQk9UVE9NLFxuICAgIFBvc2l0aW9uLkJPVFRPTV9MRUZULFxuICAgIFBvc2l0aW9uLkJPVFRPTV9SSUdIVCxcbiAgICBQb3NpdGlvbi5MRUZULFxuICAgIFBvc2l0aW9uLlJJR0hUXG4gIF0pLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIHRoZSBQb3BvdmVyIGlzIG1hbnVhbGx5IHNob3duLlxuICAgKi9cbiAgaXNTaG93bjogUHJvcFR5cGVzLmJvb2wsXG4gIC8qKlxuICAgKiBPcGVuIHRoZSBQb3BvdmVyIGJhc2VkIG9uIGNsaWNrIG9yIGhvdmVyLiBEZWZhdWx0IGlzIGNsaWNrLlxuICAgKi9cbiAgdHJpZ2dlcjogUHJvcFR5cGVzLm9uZU9mKFsnY2xpY2snLCAnaG92ZXInXSksXG5cbiAgLyoqXG4gICAqIFRoZSBjb250ZW50IG9mIHRoZSBQb3BvdmVyLlxuICAgKi9cbiAgY29udGVudDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm5vZGUsIFByb3BUeXBlcy5mdW5jXSkuaXNSZXF1aXJlZCxcblxuICAvKipcbiAgICogVGhlIHRhcmdldCBidXR0b24gb2YgdGhlIFBvcG92ZXIuXG4gICAqIFdoZW4gYSBmdW5jdGlvbiB0aGUgZm9sbG93aW5nIGFyZ3VtZW50cyBhcmUgcGFzc2VkOlxuICAgKiAoeyB0b2dnbGU6IEZ1bmN0aW9uIC0+IFZvaWQsIGdldFJlZjogRnVuY3Rpb24gLT4gUmVmLCBpc1Nob3duOiBCb29sIH0pXG4gICAqL1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmVsZW1lbnQsIFByb3BUeXBlcy5mdW5jXSkuaXNSZXF1aXJlZCxcblxuICAvKipcbiAgICogVGhlIGRpc3BsYXkgcHJvcGVydHkgcGFzc2VkIHRvIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBkaXNwbGF5OiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gIC8qKlxuICAgKiBUaGUgbWluIHdpZHRoIG9mIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBtaW5XaWR0aDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm51bWJlciwgUHJvcFR5cGVzLnN0cmluZ10pLFxuXG4gIC8qKlxuICAgKiBUaGUgbWluIGhlaWdodCBvZiB0aGUgUG9wb3ZlciBjYXJkLlxuICAgKi9cbiAgbWluSGVpZ2h0OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubnVtYmVyLCBQcm9wVHlwZXMuc3RyaW5nXSksXG5cbiAgLyoqXG4gICAqIFByb3BlcnRpZXMgcGFzc2VkIHRocm91Z2ggdG8gdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIHN0YXRlbGVzc1Byb3BzOiBQcm9wVHlwZXMuc2hhcGUoUG9wb3ZlclN0YXRlbGVzcy5wcm9wVHlwZXMpLFxuXG4gIC8qKlxuICAgKiBEdXJhdGlvbiBvZiB0aGUgYW5pbWF0aW9uLlxuICAgKi9cbiAgYW5pbWF0aW9uRHVyYXRpb246IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSBQb3BvdmVyIG9wZW5zLlxuICAgKi9cbiAgb25PcGVuOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gZmlyZWQgd2hlbiBQb3BvdmVyIGNsb3Nlcy5cbiAgICovXG4gIG9uQ2xvc2U6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGVudGVyIHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAqL1xuICBvbk9wZW5Db21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgZXhpdCB0cmFuc2l0aW9uIGlzIGNvbXBsZXRlLlxuICAgKi9cbiAgb25DbG9zZUNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBib2R5IGlzIGNsaWNrZWQuXG4gICAqL1xuICBvbkJvZHlDbGljazogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSwgYnJpbmcgZm9jdXMgaW5zaWRlIG9mIHRoZSBQb3BvdmVyIG9uIG9wZW4uXG4gICAqL1xuICBicmluZ0ZvY3VzSW5zaWRlOiBQcm9wVHlwZXMuYm9vbCxcblxuICAvKipcbiAgICogQm9vbGVhbiBpbmRpY2F0aW5nIGlmIGNsaWNraW5nIG91dHNpZGUgdGhlIGRpYWxvZyBzaG91bGQgY2xvc2UgdGhlIGRpYWxvZy5cbiAgICovXG4gIHNob3VsZENsb3NlT25FeHRlcm5hbENsaWNrOiBQcm9wVHlwZXMuYm9vbFxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3BvdmVyXG4iXX0=